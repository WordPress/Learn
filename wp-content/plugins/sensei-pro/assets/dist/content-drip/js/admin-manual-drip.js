!function(e,t,s){ManualContentDrip=s.View.extend({el:".postbox.manual-content-drip",events:{"change #scd_select_learner":"setUserID","change #scd_select_course_lesson":"setLessonID"},initialize:function(){this.selectedUserID="",this.selectedLessonID="",this.manualDripState="",this.learnerSelect=this.$("#scd_select_learner"),this.lessonSelect=this.$("#scd_select_course_lesson"),this.button=this.$("#scd_log_learner_lesson_manual_drip_submit"),t.isUndefined(e.fn.select2)||(this.learnerSelect.select2(),this.lessonSelect.select2().hide()),this.listenTo(this,"lessonSelected",this.getManualDripStatus),this.render()},setUserID:function(e){return"change"!==e.type||"scd_select_learner"!==e.target.id||t.isEmpty(e.target.value)?this.selectedUserID="":this.selectedUserID=parseInt(e.target.value),this.render(),this},setLessonID:function(e){return"change"!==e.type||"scd_select_course_lesson"!==e.target.id||t.isEmpty(e.target.value)?this.selectedLessonID="":(this.selectedLessonID=parseInt(e.target.value),this.trigger("lessonSelected",this.selectedLessonID)),this.render(),this},getManualDripStatus:function(s){if(!t.isEmpty(s+"")){var n={action:"get_manual_drip_status",nonce:scdManualDrip.nonce,userId:this.selectedUserID,lessonId:s};this.$("img.loading").removeClass("hidden");var i=this;e.post(ajaxurl,n,(function(e){e.success?(scdManualDrip.nonce=e.data.newNonce,i.manualDripState=e.data.manualDripStatus):console.log(e.data.notice),i.render(),i.$("img.loading").addClass("hidden")}))}},render:function(){return this.lessonSelect.hide(),this.button.hide(),t.isEmpty(this.selectedUserID+"")||this.lessonSelect.show(),t.isUndefined(this.manualDripState)||t.isEmpty(this.selectedLessonID+"")||(this.manualDripState?(this.button.attr("value",scdManualDrip.removeAccessValue),this.button.html(scdManualDrip.removeAccessText),this.button.removeClass("button-primary"),this.button.addClass("button-secondary")):(this.button.attr("value",scdManualDrip.giveAccessValue),this.button.html(scdManualDrip.giveAccessText),this.button.removeClass("button-secondary"),this.button.addClass("button-primary")),this.button.show()),this}}),window.manualContentDrip=new ManualContentDrip}(jQuery,_,Backbone);