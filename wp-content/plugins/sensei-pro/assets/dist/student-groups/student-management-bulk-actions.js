(()=>{var e={4184:(e,t)=>{var n;!function(){"use strict";var s={}.hasOwnProperty;function r(){for(var e=[],t=0;t<arguments.length;t++){var n=arguments[t];if(n){var o=typeof n;if("string"===o||"number"===o)e.push(n);else if(Array.isArray(n)){if(n.length){var a=r.apply(null,n);a&&e.push(a)}}else if("object"===o)if(n.toString===Object.prototype.toString)for(var l in n)s.call(n,l)&&n[l]&&e.push(l);else e.push(n.toString())}}return e.join(" ")}e.exports?(r.default=r,e.exports=r):void 0===(n=function(){return r}.apply(t,[]))||(e.exports=n)}()}},t={};function n(s){var r=t[s];if(void 0!==r)return r.exports;var o=t[s]={exports:{}};return e[s](o,o.exports,n),o.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var s in t)n.o(t,s)&&!n.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{"use strict";const e=window.wp.element,t=window.wp.hooks,s=window.wp.i18n,r=window.wp.components,o=window.wp.primitives,a=(0,e.createElement)(o.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},(0,e.createElement)(o.Path,{d:"M13.5 6C10.5 6 8 8.5 8 11.5c0 1.1.3 2.1.9 3l-3.4 3 1 1.1 3.4-2.9c1 .9 2.2 1.4 3.6 1.4 3 0 5.5-2.5 5.5-5.5C19 8.5 16.5 6 13.5 6zm0 9.5c-2.2 0-4-1.8-4-4s1.8-4 4-4 4 1.8 4 4-1.8 4-4 4z"})),l=window.wp.escapeHtml,i=window.wp.htmlEntities,u=window.wp.coreData,c=window.lodash,d=window.wp.data,p=()=>(0,e.createElement)("li",{className:"sensei-student-modal__course-list--loading"},(0,e.createElement)(r.Spinner,null)),m=()=>(0,e.createElement)("li",{className:"sensei-student-modal__course-list--empty"},(0,s.__)("No groups found.","sensei-pro")),g=t=>{let{group:n,checked:s=!1,onChange:o}=t;const a=n?.id,l=(0,i.decodeEntities)(n?.title?.rendered),[u,c]=(0,e.useState)(s),d=(0,e.useCallback)((e=>{c(e),o({isSelected:e,group:n})}),[n,o]);return(0,e.createElement)("li",{className:"sensei-student-modal__course-list__item",key:a},(0,e.createElement)(r.CheckboxControl,{id:`group-${a}`,title:l,checked:u,onChange:d}),(0,e.createElement)("label",{htmlFor:`group-${a}`,title:l},l))},h=t=>{let{searchQuery:n,onChange:r}=t;const o=(0,e.useRef)([]),a=(0,e.useCallback)((e=>{let{isSelected:t,group:n}=e;o.current=t?[...o.current,n]:o.current.filter((e=>e.id!==n.id)),r(o.current)}),[r]),{groups:l,isFetching:i}=((t,n,s)=>{const[r,o]=(0,e.useState)(n),a=(0,e.useCallback)((0,c.debounce)(o,s),[o,s]);return(0,e.useEffect)((()=>{a(n)}),n),(0,d.useSelect)(t,r)})((e=>{const t=e(u.store),s={per_page:100,search:n};return{groups:t.getEntityRecords("postType","group",s)||[],isFetching:!t.hasFinishedResolution("getEntityRecords",["postType","group",s])}}),[n],500);return(0,e.createElement)(e.Fragment,null,(0,e.createElement)("span",{className:"sensei-student-modal__course-list__header"},(0,s.__)("Your Groups","sensei-pro")),(0,e.createElement)("ul",{className:"sensei-student-modal__course-list"},i&&(0,e.createElement)(p,null),!i&&0===l.length&&(0,e.createElement)(m,null),!i&&0<l.length&&l.map((t=>(0,e.createElement)(g,{key:t.id,group:t,onChange:a,checked:o.current.length>0&&o.current.find((e=>{let{id:n}=e;return n===t.id}))})))))};function _(){return _=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e},_.apply(this,arguments)}var w=n(4184),v=n.n(w);const f=t=>{let{className:n,id:s,label:o,value:a,help:l,iconRight:i,onChange:u,...c}=t;return(0,e.createElement)(r.BaseControl,{id:s,label:o,help:l},(0,e.createElement)("div",{className:"sensei-input-control"},(0,e.createElement)("input",_({className:v()("sensei-input-control__input",{"sensei-input-control__input--with-icon-right":i},n),type:"text",id:s,value:null===a?"":a,onChange:e=>u(e.target.value)},c)),i&&(0,e.createElement)("span",{className:"sensei-input-control__icon"},(0,e.createElement)(r.Icon,{icon:i}))))},y=window.wp.apiFetch;var E=n.n(y);const b=t=>{let{action:n,onClose:o,students:i,studentDisplayName:u}=t;const{description:c,buttonLabel:d,errorMessage:p,isDestructive:m,sendAction:g}=((e,t,n)=>{const r=(0,l.escapeHTML)(n);return{addToGroup:{description:t>1?(0,s.sprintf)(// Translators: placeholder is the number of selected students.
(0,s.__)("Select the group(s) you would like to add <strong>%d students</strong> to:","sensei-pro"),t):(0,s.sprintf)(// Translators: placeholder is the student's name.
(0,s.__)("Select the group(s) you would like to add <strong>%s</strong> to:","sensei-pro"),r),buttonLabel:(0,s.__)("Add to Groups","sensei-pro"),errorMessage:e=>(0,s._n)("Unable to add student. Please try again.","Unable to add students. Please try again.",e.length,"sensei-pro"),sendAction:async(e,t)=>await Promise.all(t.map((t=>(async(e,t)=>E()({method:"POST",path:`/sensei-pro-student-groups/v1/groups/${e}/students`,data:{student_ids:t}}))(t,e)))),isDestructive:!1},removeFromGroup:{description:t>1?(0,s.sprintf)(// Translators: placeholder is the number of selected students.
(0,s.__)("Select the group(s) you would like to remove <strong>%d students</strong> from:","sensei-pro"),t):(0,s.sprintf)(// Translators: placeholder is the student's name.
(0,s.__)("Select the group(s) you would like to remove <strong>%s</strong> from:","sensei-pro"),r),buttonLabel:(0,s.__)("Remove from Groups","sensei-pro"),errorMessage:e=>(0,s._n)("Unable to remove student. Please try again.","Unable to remove students. Please try again.",e.length,"sensei-pro"),sendAction:async(e,t)=>await Promise.all(t.map((t=>(async(e,t,n)=>E()({method:"DELETE",path:`/sensei-pro-student-groups/v1/groups/${e}/students?remove_enrolments=0`,data:{student_ids:t}}))(t,e)))),isDestructive:!0}}[e]})(n,i.length,u),[_,w]=(0,e.useState)([]),[v,y]=(0,e.useState)(""),[b,C]=(0,e.useState)(!1),[S,k]=(0,e.useState)(!1),{getSignal:N}=function(){const t=(0,e.useRef)(),n=(0,e.useCallback)((()=>(t.current||(t.current=new AbortController),t.current)),[]);return(0,e.useEffect)((()=>()=>n().abort()),[n]),{getSignal:(0,e.useCallback)((()=>n().signal),[n])}}(),G=(0,e.useCallback)((async()=>{C(!0);try{await g(i,_.map((e=>e.id)),{signal:N()}),o(!0)}catch(e){N().aborted||k(!0)}finally{C(!1)}}),[g,i,_,o,N]);return(0,e.createElement)(r.Modal,{className:"sensei-student-modal",title:(0,s.__)("Choose Group","sensei-pro"),onRequestClose:()=>o()},(0,e.createElement)(e.RawHTML,null,c),(0,e.createElement)(f,{iconRight:a,onChange:e=>y(e),placeholder:(0,s.__)("Search groups","sensei-pro"),value:v}),(0,e.createElement)(h,{searchQuery:v,onChange:e=>{w(e)}}),S&&(0,e.createElement)(r.Notice,{status:"error",isDismissible:!1,className:"sensei-student-modal__notice"},p(i)),(0,e.createElement)("div",{className:"sensei-student-modal__action"},(0,e.createElement)(r.Button,{className:"sensei-student-modal__action",variant:m?"":"primary",onClick:()=>G(),disabled:b||0===_.length,isDestructive:m},b&&(0,e.createElement)(r.Spinner,null),d)))};(0,t.addFilter)("senseiStudentBulkActionModal","sensei-pro",((t,n,s,r,o)=>["addToGroup","removeFromGroup"].includes(n)?(0,e.createElement)(b,{action:n,onClose:s,students:r,studentDisplayName:o}):t)),(0,t.addFilter)("senseiStudentActionMenuControls","sensei-pro",((e,t,n)=>(e.push({title:(0,s.__)("Add to Group","sensei-pro"),onClick:()=>{t("addToGroup"),n(!0)}}),e.push({title:(0,s.__)("Remove from Group","sensei-pro"),onClick:()=>{t("removeFromGroup"),n(!0)}}),e)))})()})();