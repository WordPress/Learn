!function(){var e={184:function(e,t){var s;!function(){"use strict";var r={}.hasOwnProperty;function o(){for(var e=[],t=0;t<arguments.length;t++){var s=arguments[t];if(s){var n=typeof s;if("string"===n||"number"===n)e.push(s);else if(Array.isArray(s)){if(s.length){var c=o.apply(null,s);c&&e.push(c)}}else if("object"===n)if(s.toString===Object.prototype.toString)for(var l in s)r.call(s,l)&&s[l]&&e.push(l);else e.push(s.toString())}}return e.join(" ")}e.exports?(o.default=o,e.exports=o):void 0===(s=function(){return o}.apply(t,[]))||(e.exports=s)}()},794:function(e,t){var s;!function(){"use strict";var r={}.hasOwnProperty;function o(){for(var e=[],t=0;t<arguments.length;t++){var s=arguments[t];if(s){var n=typeof s;if("string"===n||"number"===n)e.push(s);else if(Array.isArray(s)){if(s.length){var c=o.apply(null,s);c&&e.push(c)}}else if("object"===n)if(s.toString===Object.prototype.toString)for(var l in s)r.call(s,l)&&s[l]&&e.push(l);else e.push(s.toString())}}return e.join(" ")}e.exports?(o.default=o,e.exports=o):void 0===(s=function(){return o}.apply(t,[]))||(e.exports=s)}()}},t={};function s(r){var o=t[r];if(void 0!==o)return o.exports;var n=t[r]={exports:{}};return e[r](n,n.exports,s),n.exports}s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,{a:t}),t},s.d=function(e,t){for(var r in t)s.o(t,r)&&!s.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},function(){"use strict";var e=window.wp.element,t=window.wp.plugins,r=window.wp.data,o=window.wp.editPost,n=window.wp.i18n,c=window.wp.components;function l(){return l=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var r in s)Object.prototype.hasOwnProperty.call(s,r)&&(e[r]=s[r])}return e},l.apply(this,arguments)}var i=window.lodash,a=window.wp.dataControls,d=window.wp.url,u=window.wp.deprecated,p=s.n(u);const m={setNonMembershipProducts:e=>({type:"DEPRECATED_SET_NORMAL_PRODUCTS",products:e}),setAssignableProducts:function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return{type:"SET_ASSIGNABLE_PRODUCTS",ids:e.map((e=>e.id)),entities:(0,i.keyBy)(e,"id"),onTop:t}},setLinkedMembershipProducts:e=>({type:"SET_LINKED_MEMBERSHIP_PRODUCTS",ids:e.map((e=>e.id)),entities:(0,i.keyBy)(e,"id")}),*toggleProduct(e,t){var s;const o=null===(s=yield r.controls.select("core/editor","getEditedPostAttribute","meta"))||void 0===s?void 0:s._course_woocommerce_product;let n;n=t?[...o,e]:o.filter((t=>t!==e)),yield r.controls.dispatch("core/editor","editPost",{meta:{_course_woocommerce_product:n}})},*updateSelectedProducts(e){yield r.controls.dispatch("core/editor","editPost",{meta:{_course_woocommerce_product:e}})},toggleModalProduct:(e,t)=>({type:"TOGGLE_MODAL_PRODUCT",productId:e,add:t}),updateModalSelectedProducts:e=>({type:"UPDATE_MODAL_SELECTED_PRODUCTS",productIds:e}),*createProduct(e){let{name:t,price:s,description:o}=e,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const c=yield(0,a.apiFetch)({path:"/wc/v3/products",method:"POST",data:{name:t,type:"simple",regular_price:s,virtual:!0,description:o,short_description:o}});yield m.setAssignableProducts([{id:c.id,name:c.name,description:c.short_description,price_html:c.price_html,linked_courses:[],total_sales:0}],!0),n?yield m.toggleModalProduct(c.id,!0):yield m.toggleProduct(c.id,!0);const l=yield r.controls.select("core/editor","getCurrentPost");window.sensei_log_event("course_product_add",{course_id:l.id,is_modal:n?1:0})}},_={getProducts:e=>{let{normalProducts:t,membershipProducts:s}=e;return p()("getProducts selector",{since:"2.4.0",alternative:"getLinkedProducts and getLinkedMembershipProducts"}),[...t,...s]},getAssignableProducts:(e,t)=>{let{products:{assignableProductIds:s,entities:r}}=e;const o=s.map((e=>r[e]));return t?o.filter((e=>e.name.match(new RegExp(t,"i")))):o},getHasAssignableProducts:e=>{let{products:{assignableProductIds:t}}=e;return t.length>0},getLinkedProducts:(0,r.createRegistrySelector)((e=>t=>{var s;let{products:{entities:r}}=t;return((null===(s=e("core/editor").getEditedPostAttribute("meta"))||void 0===s?void 0:s._course_woocommerce_product)||[]).map((e=>null==r?void 0:r[e])).filter((e=>e))})),getToggledProductsWithSales:(0,r.createRegistrySelector)((e=>t=>{var s,r;let{products:{entities:o}}=t;const n=(null===(s=e("core/editor").getCurrentPostAttribute("meta"))||void 0===s?void 0:s._course_woocommerce_product)||[],c=(null===(r=e("core/editor").getEditedPostAttribute("meta"))||void 0===r?void 0:r._course_woocommerce_product)||[],l=(e,t)=>(0,i.difference)(e,t).map((e=>null==o?void 0:o[e])).filter((e=>e.total_sales>0));return{added:l(c,n),removed:l(n,c)}})),getModalSelectedProductIds:e=>{let{products:{modalSelectedProductIds:t}}=e;return t},getLinkedMembershipProducts:e=>{let{products:{linkedMembershipProductIds:t,entities:s}}=e;return t.map((e=>null==s?void 0:s[e])).filter((e=>e))},getProductById:(e,t)=>{let{products:{entities:s}}=e;return s[t]}},g={*getProducts(){var e,t;const s=yield r.controls.select("core/editor","getCurrentPost"),o=s.course_membership_products?s.course_membership_products:[],c=[...null!==(e=s.meta)&&void 0!==e&&e._course_woocommerce_product?s.meta._course_woocommerce_product:[],...o];if(0===c.length)return;let l={};try{l=yield(0,a.apiFetch)({path:`/sensei-wcpc-internal/v1/course-products?include=${c.join(",")}`})}catch(e){const t=(0,n.sprintf)(
/* translators: Error message. */
(0,n.__)("An error was encountered while fetching products: %s","sensei-lms"),e.message);return void(yield r.controls.dispatch("core/notices","createErrorNotice",t,{id:"sensei-products-fetch-error"}))}if(null!==(t=l)&&void 0!==t&&t.products.length){const e=(0,i.uniq)(c).map((e=>(0,i.find)(l.products,{id:e}))).filter((e=>e)),t=(0,i.remove)(e,(e=>o.includes(e.id)));return yield{type:"DEPRECATED_SET_MEMBERSHIP_PRODUCTS",products:t},m.setNonMembershipProducts(e)}},*getAssignableProducts(e){try{const t=yield r.controls.select("core/editor","getCurrentPost"),s=(0,d.addQueryArgs)("/sensei-wcpc-internal/v1/course-products",{course_id:t.id,per_page:-1,catalog_visibility:"visible",search:e||void 0,linked_first:!e||void 0}),o=yield(0,a.apiFetch)({path:s}),n=(null==o?void 0:o.products)||[];yield m.setAssignableProducts(n)}catch(e){const t=(0,n.sprintf)(
/* translators: Error message. */
(0,n.__)("An error was encountered while fetching assignable products: %s","sensei-lms"),e.message);yield r.controls.dispatch("core/notices","createErrorNotice",t,{id:"sensei-assignable-products-fetch-error"})}},*getLinkedProducts(){yield r.controls.select(h,"getAssignableProducts","")},*getLinkedMembershipProducts(){try{const e=yield r.controls.select("core/editor","getCurrentPost"),t=e.course_membership_products?e.course_membership_products:[];if(t.length>0){const e=yield(0,a.apiFetch)({path:`/sensei-wcpc-internal/v1/course-products?include=${t.join(",")}`}),s=(null==e?void 0:e.products)||[];return m.setLinkedMembershipProducts(s)}}catch(e){const t=(0,n.sprintf)(
/* translators: Error message. */
(0,n.__)("An error was encountered while fetching membership products: %s","sensei-lms"),e.message);yield r.controls.dispatch("core/notices","createErrorNotice",t,{id:"sensei-membership-products-fetch-error"})}}},h="sensei-wc-paid-courses/products";(0,r.registerStore)(h,{reducer:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{normalProducts:[],membershipProducts:[],products:{assignableProductIds:[],linkedMembershipProductIds:[],modalSelectedProductIds:[],entities:{}}},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"DEPRECATED_SET_NORMAL_PRODUCTS":const s=t.products.filter((t=>{let{id:s}=t;return void 0===(0,i.find)(e.membershipProducts,{id:s})}));return 0===(0,i.xorBy)(e.normalProducts,s,"id").length?e:{...e,normalProducts:s};case"DEPRECATED_SET_MEMBERSHIP_PRODUCTS":const r=e.normalProducts.filter((e=>{let{id:s}=e;return void 0===(0,i.find)(t.products,{id:s})}));return{...e,membershipProducts:[...t.products],normalProducts:r};case"SET_ASSIGNABLE_PRODUCTS":const o=(0,i.uniq)(t.onTop?[...t.ids,...e.products.assignableProductIds]:[...e.products.assignableProductIds,...t.ids]);return{...e,products:{...e.products,assignableProductIds:o,entities:{...e.products.entities,...t.entities}}};case"SET_LINKED_MEMBERSHIP_PRODUCTS":return{...e,products:{...e.products,linkedMembershipProductIds:(0,i.uniq)([...e.products.linkedMembershipProductIds,...t.ids]),entities:{...e.products.entities,...t.entities}}};case"TOGGLE_MODAL_PRODUCT":const n=t.add?[...e.products.modalSelectedProductIds,t.productId]:e.products.modalSelectedProductIds.filter((e=>e!==t.productId));return{...e,products:{...e.products,modalSelectedProductIds:n}};case"UPDATE_MODAL_SELECTED_PRODUCTS":return{...e,products:{...e.products,modalSelectedProductIds:t.productIds}};default:return e}},actions:m,selectors:_,resolvers:g,controls:a.controls}),(()=>{const e=(0,r.select)("core/editor");let t;(e=>{let{subscribeListener:t=(()=>{}),onSetDirty:s=(()=>{}),onSaveStart:o=(()=>{}),onSave:n=(()=>{})}=e;const c=(0,r.select)("core/editor");let l=!1,i=!1;(0,r.subscribe)((()=>{t();const e=c.isEditedPostDirty(),r=c.isSavingPost()&&!c.isAutosavingPost();!i&&e?(i=!0,s()):i=e,l&&!r?(l=r,n()):!l&&r?(l=r,o()):l=r}))})({onSaveStart:()=>{var s;t=(null===(s=e.getCurrentPostAttribute("meta"))||void 0===s?void 0:s._course_woocommerce_product)||[]},onSave:()=>{var s;const r=(null===(s=e.getCurrentPostAttribute("meta"))||void 0===s?void 0:s._course_woocommerce_product)||[],o=e.getCurrentPost();t!==r&&window.sensei_log_event("course_product_update",{course_id:o.id,course_status:o.status,product_count:r.length})}})})();const E=window.senseiWcPaidCoursesBlockEditorData.wc_currency_symbol;var w=function(){let{fieldsetClassName:t,fieldClassName:s,modalScope:o=!1}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{createProduct:i}=(0,r.useDispatch)(h),[a,d]=(0,e.useState)({}),[u,p]=(0,e.useState)(!1),[m,_]=(0,e.useState)(null),g=e=>({value:a[e]||"",onChange:t=>d((s=>({...s,[e]:t})))});return{fieldset:(0,e.createElement)("fieldset",{className:t},m&&(0,e.createElement)(c.Notice,{className:"sensei-wcpc-new-product__error",status:"error",isDismissible:!1},(0,e.createElement)(e.RawHTML,null,m)),(0,e.createElement)(c.TextControl,l({className:s,label:(0,n.__)("Name","sensei-pro"),required:!0},g("name"))),(0,e.createElement)(c.TextControl,l({className:s,label:(0,e.createElement)(e.Fragment,null,(0,n.__)("Price","sensei-pro"),E&&(0,e.createElement)(e.RawHTML,{style:{display:"inline"}},` (${E})`)),type:"number",required:!0},g("price"))),(0,e.createElement)(c.TextareaControl,l({className:s,label:(0,n.__)("Description (Optional)","sensei-pro")},g("description")))),formState:a,isSubmitting:u,saveProduct:async()=>{let e=!1;p(!0);try{await i(a,o),d({}),_(null),e=!0}catch(e){_((0,n.sprintf)(
/* translators: Error message. */
(0,n.__)("An error was encountered while creating the product: %s","sensei-pro"),e.message))}return p(!1),e}}},b=t=>{let{showCreateButton:s,isFormActive:r,setFormActive:o}=t;const{fieldset:l,isSubmitting:i,saveProduct:a}=w({fieldsetClassName:"sensei-wcpc-course-pricing__new-product-fieldset"});return r?(0,e.createElement)("form",{onSubmit:async e=>{e.preventDefault(),await a()&&o(!1)}},l,(0,e.createElement)("ul",{className:"sensei-wcpc-new-product__action-buttons"},(0,e.createElement)("li",null,(0,e.createElement)(c.Button,{className:"sensei-wcpc-new-product__create-product-button",isSecondary:!0,type:"submit",disabled:i},(0,n.__)("Create product","sensei-pro"),i&&(0,e.createElement)(c.Spinner,null))),(0,e.createElement)("li",null,(0,e.createElement)(c.Button,{isTertiary:!0,disabled:i,onClick:()=>o(!1)},(0,n.__)("Cancel","sensei-pro"))))):s?(0,e.createElement)(c.Button,{isTertiary:!0,onClick:()=>o(!0)},(0,n.__)("Create a new product","sensei-pro")):null},P=window.wp.primitives,v=(0,e.createElement)(P.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},(0,e.createElement)(P.Path,{d:"M12 13.06l3.712 3.713 1.061-1.06L13.061 12l3.712-3.712-1.06-1.06L12 10.938 8.288 7.227l-1.061 1.06L10.939 12l-3.712 3.712 1.06 1.061L12 13.061z"})),f=t=>{let{toggleProduct:s}=t;const{products:o}=(0,r.useSelect)((e=>({products:e(h).getLinkedProducts()})));return(0,e.createElement)("ul",{className:"sensei-wcpc-course-pricing__selected-list"},o.map((t=>(0,e.createElement)("li",{key:t.id,className:"sensei-wcpc-course-pricing__selected-list__item"},(0,e.createElement)("span",{className:"sensei-wcpc-course-pricing__selected-list__product-text"},t.name,t.price_html&&(0,e.createElement)(e.RawHTML,{className:"sensei-wcpc-course-pricing__selected-list__price"}," — "+t.price_html)),(0,e.createElement)(c.Button,{className:"sensei-wcpc-course-pricing__selected-list__remove-button",onClick:()=>s(t.id,!1),icon:v,label:(0,n.__)("Remove product","sensei-pro")})))))},y=s(184),S=s.n(y),C=t=>{let{className:s,contentLabel:r,title:o,intro:l,actions:i,formProps:a,onClose:d,children:u}=t;const p=a?"form":e.Fragment;return(0,e.createElement)(c.Modal,{className:S()(s,"sensei-wcpc-modal"),onRequestClose:d,contentLabel:r},(0,e.createElement)("header",{className:"sensei-wcpc-modal__header"},(0,e.createElement)("h1",{className:"sensei-wcpc-modal__title"},o),l&&(0,e.createElement)("p",{className:"sensei-wcpc-modal__intro"},l)),(0,e.createElement)(c.Button,{className:"sensei-wcpc-modal__close-button",onClick:d,icon:v,label:(0,n.__)("Close modal","sensei-pro")}),(0,e.createElement)(p,a||{},u,i&&(0,e.createElement)("ul",{className:"sensei-wcpc-modal__buttons-list"},i.map((t=>{let{id:s,label:r,inverted:o,buttonProps:n}=t;return(0,e.createElement)("li",{key:s,className:S()({"sensei-wcpc-modal__buttons-list__text-item":!n,"sensei-wcpc-modal__buttons-list__inverted-position-item":o})},n?(0,e.createElement)(c.Button,n,r):r)})))))},k=t=>{let{onBack:s,onClose:o}=t;const{toggledProductsWithSales:l}=(0,r.useSelect)((e=>({toggledProductsWithSales:e(h).getToggledProductsWithSales()}))),{toggleProduct:i}=(0,r.useDispatch)(h),a=l.added.length,d=l.removed.length;(0,e.useEffect)((()=>{0===a&&0===d&&o()}),[a,d]);const u=(0,e.createElement)("thead",null,(0,e.createElement)("tr",null,(0,e.createElement)("th",null,(0,n.__)("Product","sensei-pro")),(0,e.createElement)("th",null,(0,n.__)("Price","sensei-pro")),(0,e.createElement)("th",null,(0,n.__)("Linked courses","sensei-pro")),(0,e.createElement)("th",null,(0,n.__)("Purchases","sensei-pro")),(0,e.createElement)("th",null,(0,n.__)("Action","sensei-pro")))),p=(t,s)=>r=>(0,e.createElement)("tr",{key:r.id},(0,e.createElement)("td",{className:"sensei-wcpc-enrollment-updates-modal__table__product-name"},r.name),(0,e.createElement)("td",null,(0,e.createElement)(e.RawHTML,null,r.price_html)),(0,e.createElement)("td",null,0===r.linked_courses.length?(0,n.__)("No linked courses","sensei-pro"):(0,n.sprintf)(// translators: placeholder is number of linked courses.
(0,n._n)("%d linked course","%d linked courses",r.linked_courses.length,"sensei-pro"),r.linked_courses.length)),(0,e.createElement)("td",null,(0,n.sprintf)(// translators: placeholder is the total sales.
(0,n._n)("%d purchase","%d purchases",r.total_sales,"sensei-pro"),r.total_sales)),(0,e.createElement)("td",{className:"sensei-wcpc-enrollment-updates-modal__table__action"},(0,e.createElement)(c.Button,{isTertiary:!0,onClick:()=>s(r)},t))),m=[{id:"proceed",label:(0,n.__)("Proceed with updates","sensei-pro"),buttonProps:{isPrimary:!0,onClick:o}}];return s&&m.unshift({id:"back",label:(0,n.__)("< Back","sensei-pro"),inverted:!0,buttonProps:{isSecondary:!0,onClick:s}}),(0,e.createElement)(C,{contentLabel:(0,n.__)("Enrollment updates","sensei-pro"),title:(0,n.__)("Are you sure you want to make these enrollment updates?","sensei-pro"),actions:m,onClose:o},a>0&&(0,e.createElement)(e.Fragment,null,(0,e.createElement)("p",null,(0,n._n)("Linking this product may enroll all learners who have already purchased it.","Linking these products may enroll all learners who have already purchased any of them.",a,"sensei-pro")),(0,e.createElement)("table",{className:"sensei-wcpc-enrollment-updates-modal__table"},u,(0,e.createElement)("tbody",null,l.added.map(p((0,n.__)("Remove product","sensei-pro"),(e=>{i(e.id,!1)})))))),d>0&&(0,e.createElement)(e.Fragment,null,(0,e.createElement)("p",null,(0,n._n)("Unlinking this product may unenroll all the learners who have already purchased it.","Unlinking these products may unenroll all the learners who have already purchased any of them.",d,"sensei-pro")),(0,e.createElement)("table",{className:"sensei-wcpc-enrollment-updates-modal__table"},u,(0,e.createElement)("tbody",null,l.removed.map(p((0,n.__)("Add product","sensei-pro"),(e=>{i(e.id,!0)})))))))},N=()=>{const[t,s]=(0,e.useState)(!1),[o,l]=(0,e.useState)(!1),{toggledProductsWithSales:i}=(0,r.useSelect)((e=>({toggledProductsWithSales:e(h).getToggledProductsWithSales()}))),a=i.added.length,d=i.removed.length;return(0,e.createElement)(e.Fragment,null,!t&&(a>0||d>0)&&(0,e.createElement)(c.Notice,{className:"sensei-wcpc-course-pricing__notice",status:"warning",isDismissible:!0,onRemove:()=>s(!0),actions:[{label:(0,n.__)("Review","sensei-pro"),onClick:()=>l(!0)}]},(0,e.createElement)("p",null,(0,n.__)("You have some enrollment updates","sensei-pro"))),o&&(0,e.createElement)(k,{onClose:()=>l(!1)}))},T=()=>{const[t,s]=(0,e.useState)(""),o=(0,e.useCallback)((0,i.debounce)((e=>{s(e)}),250),[]),{products:n,isLoadingProducts:c,hasAssignableProducts:l}=(0,r.useSelect)((e=>{const s=e(h);return{products:s.getAssignableProducts(t),isLoadingProducts:!s.hasFinishedResolution("getAssignableProducts",[t]),hasAssignableProducts:s.getHasAssignableProducts()}}),[t]);return{products:n,isLoadingProducts:c,hasAssignableProducts:l,onSearch:o}},L=()=>{const{products:t,isLoadingProducts:s,hasAssignableProducts:l,onSearch:i}=T(),{selectedProductIds:a}=(0,r.useSelect)((e=>{var t;return{selectedProductIds:null===(t=e("core/editor").getEditedPostAttribute("meta"))||void 0===t?void 0:t._course_woocommerce_product}})),{courseId:d}=(0,r.useSelect)((e=>{var t;return{courseId:null===(t=e("core/editor").getCurrentPost())||void 0===t?void 0:t.id}})),{toggleProduct:u}=(0,r.useDispatch)(h),[p,m]=(0,e.useState)(!1);let _;return _=s||!a?(0,e.createElement)("div",{className:"sensei-wcpc-course-pricing__loading"},(0,e.createElement)(c.Spinner,null)):l?0===t.length?(0,n.__)("No products found.","sensei-pro"):(0,e.createElement)("ul",{className:"sensei-wcpc-course-pricing__selection-list"},t.map((t=>(0,e.createElement)("li",{key:t.id,className:"sensei-wcpc-course-pricing__selection-list__item"},(0,e.createElement)(c.CheckboxControl,{label:(0,e.createElement)(e.Fragment,null,(0,e.createElement)("span",{className:"sensei-wcpc-course-pricing__selection-list__item__name"},t.name),(0,e.createElement)("span",{className:"sensei-wcpc-course-pricing__selection-list__item__details"},t.price_html&&(0,e.createElement)(e.RawHTML,{className:"sensei-wcpc-course-pricing__selection-list__item__price"},t.price_html),(0,e.createElement)("span",null,0===t.linked_courses.length?(0,n.__)("No linked courses","sensei-pro"):(0,n.sprintf)(// translators: placeholder is number of linked courses.
(0,n._n)("%d linked course","%d linked courses",t.linked_courses.length,"sensei-pro"),t.linked_courses.length)))),checked:a.includes(t.id),onChange:e=>{u(t.id,e),window.sensei_log_event("course_pricing_product_select",{course_id:d,product_id:t.id,enabled:e?1:0})}}))))):!p&&(0,e.createElement)("div",null,(0,e.createElement)("p",null,(0,n.__)("You don’t have any products yet. Get started by creating a new WooCommerce product.","sensei-pro")),(0,e.createElement)(c.Button,{isSecondary:!0,isSmall:!0,onClick:()=>m(!0)},(0,n.__)("Create a product","sensei-pro"))),(0,e.createElement)(o.PluginDocumentSettingPanel,{className:"sensei-wcpc-course-pricing",name:"sensei-wcpc-pricing",title:(0,n.__)("Pricing","sensei-pro")},(0,e.createElement)("p",null,(0,n.__)("To access this course, learners will need to purchase one of the assigned products.","sensei-pro")),(0,e.createElement)(f,{toggleProduct:u}),(0,e.createElement)(N,null),l&&(0,e.createElement)(c.TextControl,{type:"search",label:(0,n.__)("Link one or more products to this course to set the price.","sensei-pro"),placeholder:(0,n.__)("Search for a product","sensei-pro"),onChange:i}),_&&(0,e.createElement)("div",{className:"sensei-wcpc-course-pricing__selection-list-wrapper"},_),(0,e.createElement)(b,{showCreateButton:l,isFormActive:p,setFormActive:m}))};(0,t.registerPlugin)("sensei-wc-paid-courses-pricing-sidebar-plugin",{render:()=>(0,e.createElement)(L,null),icon:null}),(()=>{const e="sensei-wc-paid-courses-pricing-sidebar-plugin/sensei-wcpc-pricing",t=`${e}_first-load`;window.localStorage.getItem(t)||(0,r.select)("core/edit-post").isEditorPanelOpened(e)||((0,r.dispatch)("core/edit-post").toggleEditorPanelOpened(e),window.localStorage.setItem(t,!0))})();var A=window.wp.hooks,M=window.wp.compose,I=window.wp.blockEditor,D=t=>{let{products:s,onChange:r,selectedProductId:o}=t;return(0,e.createElement)("div",{className:"wp-block-sensei-lms-purchase-course__products"},(0,e.createElement)("form",null,(0,e.createElement)("ul",{className:"wp-block-sensei-lms-purchase-course__products__list"},s.map((t=>(0,e.createElement)("li",{key:t.id,className:"wp-block-sensei-lms-purchase-course__products__item"},(0,e.createElement)("label",null,(0,e.createElement)("input",{className:"wp-block-sensei-lms-purchase-course__products__radio",name:"wcpc-radio-product",type:"radio",onChange:()=>r(t.id),checked:t.id===o}),(0,e.createElement)("span",{className:"wp-block-sensei-lms-purchase-course__products__label"},(0,e.createElement)("strong",{className:"wp-block-sensei-lms-purchase-course__products__product-title"},t.name),(0,e.createElement)("span",{className:"wp-block-sensei-lms-purchase-course__products__product-description"},(0,e.createElement)(e.RawHTML,null,t.description)),(0,e.createElement)("span",{className:"wp-block-sensei-lms-purchase-course__products__price"},(0,e.createElement)(e.RawHTML,null,t.price_html))))))))))};const R=t=>{const{products:s,EditTakeCourse:r}=t,[o,c]=(0,e.useState)(null);let a=null;o&&(a=(0,i.find)(s,{id:o})),1!==s.length&&a||(a=s[0]);let d=(0,n.__)("Purchase Course","sensei-pro");return a&&(d=`${a.price_html} - ${d}`),(0,e.createElement)(e.Fragment,null,s.length>1&&(0,e.createElement)(D,{products:s,onChange:c,selectedProductId:a.id}),(0,e.createElement)(r,l({},t,{text:(0,e.createElement)(e.RawHTML,null,d)})))};var O=(0,e.createElement)(P.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},(0,e.createElement)(P.Path,{d:"M13.5 6C10.5 6 8 8.5 8 11.5c0 1.1.3 2.1.9 3l-3.4 3 1 1.1 3.4-2.9c1 .9 2.2 1.4 3.6 1.4 3 0 5.5-2.5 5.5-5.5C19 8.5 16.5 6 13.5 6zm0 9.5c-2.2 0-4-1.8-4-4s1.8-4 4-4 4 1.8 4 4-1.8 4-4 4z"})),x=t=>{let{onClose:s,onCancel:r,onSubmit:o}=t;const{fieldset:l,isSubmitting:i,saveProduct:a}=w({fieldsetClassName:"sensei-wcpc-new-product-modal__fieldset",fieldClassName:"sensei-wcpc-new-product-modal__field",modalScope:!0}),d=[{id:"cancel",label:(0,n.__)("Cancel","sensei-pro"),buttonProps:{isSecondary:!0,type:"button",onClick:r,disabled:i}},{id:"create-product",label:(0,e.createElement)(e.Fragment,null,(0,n.__)("Create product","sensei-pro"),i&&(0,e.createElement)(c.Spinner,null)),buttonProps:{className:"sensei-wcpc-new-product__create-product-button",isPrimary:!0,type:"submit",disabled:i}}];return(0,e.createElement)(C,{className:"sensei-wcpc-new-product-modal",contentLabel:(0,n.__)("Product creation","sensei-pro"),title:(0,n.__)("Create a new product","sensei-pro"),actions:d,formProps:{onSubmit:async e=>{e.preventDefault(),await a()&&o()}},onClose:s},l)},B=t=>{let{initialSelectedProductIds:s,onSubmit:o,onClose:l}=t;const{selectedProductIds:i,toggleProduct:a,submitSelection:d}=(t=>{const{selectedProductIds:s}=(0,r.useSelect)((e=>({selectedProductIds:e(h).getModalSelectedProductIds()}))),{updateSelectedProducts:o,updateModalSelectedProducts:n,toggleModalProduct:c}=(0,r.useDispatch)(h);return(0,e.useEffect)((()=>{n(t)}),[t]),{selectedProductIds:s,toggleProduct:c,submitSelection:async()=>{await o(s)}}})(s),{products:u,isLoadingProducts:p,hasAssignableProducts:m,onSearch:_}=T(),[g,E]=(0,e.useState)(!1);if(g)return(0,e.createElement)(x,{onClose:l,onCancel:()=>E(!1),onSubmit:()=>E(!1)});let w;w=p?(0,e.createElement)("div",{className:"sensei-wcpc-product-association-modal__loading"},(0,e.createElement)(c.Spinner,null)):m?0===u.length?(0,e.createElement)("p",null,(0,n.__)("No products found.","sensei-pro")):(0,e.createElement)("table",{className:"sensei-wcpc-product-association-modal__products-table"},(0,e.createElement)("thead",null,(0,e.createElement)("tr",null,(0,e.createElement)("th",null,(0,n.__)("Select the product","sensei-pro")),(0,e.createElement)("th",null,(0,n.__)("Product","sensei-pro")),(0,e.createElement)("th",null,(0,n.__)("Price","sensei-pro")),(0,e.createElement)("th",null,(0,n.__)("Linked courses","sensei-pro")),(0,e.createElement)("th",null,(0,n.__)("Purchases","sensei-pro")))),(0,e.createElement)("tbody",null,u.map((t=>(0,e.createElement)("tr",{key:t.id},(0,e.createElement)("td",{className:"sensei-wcpc-product-association-modal__products-table__checkbox-column"},(0,e.createElement)(c.CheckboxControl,{id:`product-selection-${t.id}`,checked:i.includes(t.id),onChange:e=>a(t.id,e)})),(0,e.createElement)("td",null,(0,e.createElement)("label",{className:"sensei-wcpc-product-association-modal__products-table__product-name",htmlFor:`product-selection-${t.id}`},t.name)),(0,e.createElement)("td",null,(0,e.createElement)(e.RawHTML,null,t.price_html)),(0,e.createElement)("td",null,0===t.linked_courses.length?(0,n.__)("No linked courses","sensei-pro"):(0,n.sprintf)(// translators: placeholder is number of linked courses.
(0,n._n)("%d linked course","%d linked courses",t.linked_courses.length,"sensei-pro"),t.linked_courses.length)),(0,e.createElement)("td",null,t.total_sales>0?(0,e.createElement)(c.Tooltip,{text:(0,n.__)("Toggling this product may affect existing enrollments.","sensei-pro")},(0,e.createElement)("span",null,(0,n.__)("Has purchases","sensei-pro"))):(0,n.__)("No purchases","sensei-pro"))))))):(0,e.createElement)("div",null,(0,e.createElement)("p",null,(0,n.__)("You don’t have any products yet. Get started by creating a new WooCommerce product.","sensei-pro")),(0,e.createElement)(c.Button,{isSecondary:!0,isSmall:!0,onClick:()=>E(!0)},(0,n.__)("Create a product","sensei-pro")));const b=[{id:"selected",label:(0,n.sprintf)(// translators: placeholder is number of selected products.
(0,n._n)("%d product selected","%d products selected",i.length,"sensei-pro"),i.length)},{id:"button",label:0===s.length?(0,n.__)("Link products","sensei-pro"):(0,n.__)("Update","sensei-pro"),buttonProps:{isPrimary:!0,onClick:async()=>{await d(),o(i),l()}}}];return(0,e.createElement)(C,{className:"sensei-wcpc-product-association-modal",contentLabel:(0,n.__)("Course products association","sensei-pro"),title:(0,n.__)("Add pricing by linking one or more products to this course","sensei-pro"),intro:(0,n.__)("To access this course, learners will need to purchase one of the assigned products.","sensei-pro"),actions:b,onClose:l},(0,e.createElement)("div",{className:"sensei-wcpc-product-association-modal__actions"},(0,e.createElement)("div",{className:"sensei-wcpc-product-association-modal__search"},(0,e.createElement)("input",{className:"sensei-wcpc-product-association-modal__search__input",type:"search",title:(0,n.__)("Search for a product","sensei-pro"),placeholder:(0,n.__)("Search for a product","sensei-pro"),onChange:e=>_(e.target.value)}),(0,e.createElement)("span",{className:"sensei-wcpc-product-association-modal__search__icon"},(0,e.createElement)(c.Icon,{icon:O}))),(0,e.createElement)(c.Button,{isTertiary:!0,onClick:()=>E(!0)},(0,n.__)("Create a new product","sensei-pro"))),(0,e.createElement)("div",{className:"sensei-wcpc-product-association-modal__products"},w))};function F(){return F=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var r in s)Object.prototype.hasOwnProperty.call(s,r)&&(e[r]=s[r])}return e},F.apply(this,arguments)}var H=s(794),U=s.n(H),j=(0,e.createElement)(P.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},(0,e.createElement)(P.Path,{d:"M18.3 5.6L9.9 16.9l-4.6-3.4-.9 1.2 5.8 4.3 9.3-12.6z"})),G=t=>{let{options:s,optionsLabel:r,icon:o,value:n,onChange:l,toggleProps:i,getMenuItemProps:a,popoverProps:d,...u}=t;const p=s.find((e=>n===e.value));return(0,e.createElement)(c.Dropdown,F({className:"sensei-toolbar-dropdown",popoverProps:{isAlternate:!0,position:"bottom right left",focusOnMount:!0,...d,className:U()(null==d?void 0:d.className,"sensei-toolbar-dropdown__popover")},renderToggle:t=>{let{isOpen:s,onToggle:r}=t;return(0,e.createElement)(c.Button,F({onClick:r,icon:o,"aria-expanded":s,"aria-haspopup":"true"},i,{children:null!=i&&i.children?i.children(p):null==p?void 0:p.label}))},renderContent:t=>{let{onClose:o}=t;return(0,e.createElement)(c.NavigableMenu,{role:"menu",stopNavigationEvents:!0},(0,e.createElement)(c.MenuGroup,{label:r},s.map((t=>{const s=t.value===(null==p?void 0:p.value),r=null==a?void 0:a(t);return(0,e.createElement)(c.MenuItem,F({key:t.value,role:"menuitemradio",isSelected:s,icon:s?j:null,className:U()("sensei-toolbar-dropdown__option",{"is-selected":s},null==r?void 0:r.className),onClick:()=>{l(t.value),o()},children:t.label},r))}))))}},u))},W=t=>{let{hasMemberships:s}=t;const{updateSelectedProducts:o}=(0,r.useDispatch)(h),{metaSelectedProductIds:c}=(0,r.useSelect)((e=>({metaSelectedProductIds:e("core/editor").getEditedPostAttribute("meta")._course_woocommerce_product}))),{courseId:l}=(0,r.useSelect)((e=>{var t;return{courseId:null===(t=e("core/editor").getCurrentPost())||void 0===t?void 0:t.id}})),[i,a]=(0,e.useState)(!1),[d,u]=(0,e.useState)(!1),p=[{label:s?(0,n.__)("Membership only","sensei-pro"):(0,n.__)("Free","sensei-pro"),value:"free"},{label:(0,n.__)("Paid","sensei-pro"),value:"paid"}];return(0,e.createElement)(e.Fragment,null,(0,e.createElement)(G,{options:p,optionsLabel:(0,n.__)("Course pricing","sensei-pro"),value:c.length>0?"paid":"free",onChange:async e=>{"free"===e?(await o([]),u("free")):a(!0),window.sensei_log_event("course_signup_block_pricing_select",{course_id:l,type:e})}}),i&&(0,e.createElement)(B,{initialSelectedProductIds:c,onSubmit:e=>{u("modal"),window.sensei_log_event("course_signup_block_pricing_modal_submit",{course_id:l,product_count:e.length})},onClose:()=>a(!1)}),d&&(0,e.createElement)(k,{onBack:"modal"===d?()=>{u(!1),a(!0)}:void 0,onClose:()=>u(!1)}))},$=t=>s=>{const{products:o,membershipProducts:n}=(0,r.useSelect)((e=>({products:e(h).getLinkedProducts(),membershipProducts:e(h).getLinkedMembershipProducts()}))),a=(0,r.useSelect)((e=>e(h).hasFinishedResolution("getAssignableProducts",[""])&&e(h).hasFinishedResolution("getLinkedMembershipProducts")));if(s.attributes.isPreview)return(0,e.createElement)(t,s);if(!a)return(0,e.createElement)("div",{className:"wp-block-sensei-lms-purchase-course__centered-spinner"},(0,e.createElement)(c.Spinner,null));const d=(0,i.uniqBy)([...o,...n],"id");return(0,e.createElement)(e.Fragment,null,(0,e.createElement)(I.BlockControls,null,(0,e.createElement)(c.ToolbarGroup,null,(0,e.createElement)(W,{hasMemberships:n.length>0}))),d.length?(0,e.createElement)(R,l({products:d,EditTakeCourse:t},s)):(0,e.createElement)(t,s))};(0,A.addFilter)("blocks.registerBlockType","sensei-wc-paid-courses/purchase-course",(e=>"sensei-lms/button-take-course"!==e.name?e:{...e,keywords:[...e.keywords,(0,n.__)("Purchase","sensei-pro"),(0,n.__)("Sell","sensei-pro")],edit:(0,M.compose)($)(e.edit)}));const q=`${window.senseiWcPaidCoursesBlockEditorData.assets_url}images`,z=window.senseiWcPaidCoursesBlockEditorData.user_display_name;(0,t.registerPlugin)("sensei-wc-paid-courses-product-tour-plugin",{render:()=>{const{toggleFeature:t}=(0,r.useDispatch)("core/edit-post");return(()=>{const{onboardingCompleted:t}=(0,r.useSelect)((e=>({onboardingCompleted:e("core/edit-post").isFeatureActive("senseiCourseProductTourCompleted")}))),s=(t=>{const[s,r]=(0,e.useState)();return(0,e.useEffect)((()=>{if(!t)return;setTimeout((()=>{r(document.body.classList.contains("modal-open"))}),1);const e=new MutationObserver((()=>{r(document.body.classList.contains("modal-open"))}));return e.observe(document.body,{attributes:!0,attributeFilter:["class"]}),()=>{e.disconnect()}}),[t]),s})(!t),[o,n]=(0,e.useState)(!1);return(0,e.useLayoutEffect)((()=>{t?n(!1):!1===s&&n(!0)}),[t,s,o]),o})()?(0,e.createElement)(c.Guide,{className:"sensei-product-tour",contentLabel:(0,n.__)("How to sell courses.","sensei-pro"),finishButtonText:(0,n.__)("Done","sensei-pro"),onFinish:()=>{t("senseiCourseProductTourCompleted")},pages:[{image:(0,e.createElement)("div",{className:"sensei-product-tour__image-container"},(0,e.createElement)("img",{className:"sensei-product-tour__image",src:`${q}/product-tour-1.gif`,alt:(0,n.__)("Image showing the toolbar.","sensei-pro")})),content:(0,e.createElement)(e.Fragment,null,(0,e.createElement)("h1",{className:"sensei-product-tour__heading"},(0,n.sprintf)(
/* translators: User display name. */
(0,n.__)("Hi%s! Ready to sell your first course?","sensei-pro"),z?" "+z:"")),(0,e.createElement)("p",{className:"sensei-product-tour__text"},(0,n.__)("Simply select “Paid” from the Take Course button toolbar, which will open an overlay.","sensei-pro")))},{image:(0,e.createElement)("div",{className:"sensei-product-tour__image-container"},(0,e.createElement)("img",{className:"sensei-product-tour__image",src:`${q}/product-tour-2.gif`,alt:(0,n.__)("Image showing how to select a product.","sensei-pro")})),content:(0,e.createElement)(e.Fragment,null,(0,e.createElement)("h1",{className:"sensei-product-tour__heading"},(0,n.__)("Next, select a product.","sensei-pro")),(0,e.createElement)("p",{className:"sensei-product-tour__text"},(0,n.__)("A product is used to sell the course at your desired price.","sensei-pro")))},{image:(0,e.createElement)("div",{className:"sensei-product-tour__image-container"},(0,e.createElement)("img",{className:"sensei-product-tour__image",src:`${q}/product-tour-3.gif`,alt:(0,n.__)("Image showing how it will look like in the frontend.","sensei-pro")})),content:(0,e.createElement)(e.Fragment,null,(0,e.createElement)("h1",{className:"sensei-product-tour__heading"},(0,n.__)("Nice work! You’re ready to start selling.","sensei-pro")),(0,e.createElement)("p",{className:"sensei-product-tour__text"},(0,n.__)("Learners will have to purchase one of the assigned products to access your course.","sensei-pro")))}]}):null},icon:null})}()}();