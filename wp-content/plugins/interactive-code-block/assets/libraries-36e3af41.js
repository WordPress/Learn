import{j as e}from"./jsx-runtime-93b56483.js";import{i as m}from"./entities-35c9150f.js";import{N as w}from"./notifications-24e351eb.js";const y=({onFileSelected:t})=>{const r=wp.element.useRef(null),s=async n=>{await t(n.target.files[0]),n.target.value=null};return e.jsx("input",{type:"file",accept:"*",onChange:s,style:{position:"absolute",top:0,left:0,bottom:0,right:0,opacity:0,cursor:"pointer"},ref:r})},h=t=>{const r=s=>{s.key==="Escape"&&t()};wp.element.useEffect(()=>(document.addEventListener("keydown",r),()=>{document.removeEventListener("keydown",r)}),[t])};function f(){const{createErrorNotice:t,createSuccessNotice:r}=wp.data.useDispatch(wp.notices.store),{saveEntityRecord:s}=wp.data.useDispatch(wp.coreData.store),[n,c]=wp.element.useState(!1),d=async i=>{c(!0);const a=new FormData;a.append("file",i);try{await s("interactive-code-block","library",{name:i.name},{throwOnError:!0,__unstableFetch:({data:o,...u})=>{for(const p in o)a.append(p,o[p]);const l={...u.headers};return delete l["Content-Type"],wp.apiFetch({...u,headers:l,body:a})}}),r("Library uploaded successfully",{type:"snackbar"})}catch(o){t(`Error creating a library: ${o.message}`,{type:"snackbar"})}finally{c(!1)}};return e.jsxs(wp.components.Flex,{direction:"column",gap:4,children:[e.jsx(wp.components.FlexItem,{children:"Upload libraries (e.g. .phar files) to use in your interative code blocks. Uploading a library with the same name twice overwrites the previous version."}),e.jsx(wp.components.FlexItem,{className:"interactive-code-snippet-items-list-wrapper",children:e.jsx(b,{})}),e.jsx(wp.components.FlexItem,{children:e.jsxs(wp.components.Button,{variant:"primary",isBusy:n,style:{position:"relative"},children:["Upload a library",e.jsx(y,{onFileSelected:d})]})})]})}function b(){const t=wp.coreData.useEntityRecords("interactive-code-block","library");return t.records===null?e.jsx(wp.components.Flex,{align:"center",justify:"center",children:e.jsx(wp.components.FlexItem,{children:e.jsx(wp.components.Spinner,{})})}):t.records?.length?e.jsx("ul",{className:"interactive-code-snippet-items-list",children:t.records.map(({id:r})=>e.jsx(x,{id:r},r))}):e.jsx("div",{children:"No results"})}const x=({id:t})=>{const{createSuccessNotice:r,createErrorNotice:s}=wp.data.useDispatch(wp.notices.store),n=wp.coreData.useEntityRecord("interactive-code-block","library",t),{deleteEntityRecord:c}=wp.data.useDispatch("core"),[d,i]=wp.element.useState(!1);h(function(){d&&(n.edit({name:n.record.name}),i(!1))});const a=async()=>{if(window.confirm(wp.i18n.__("Are you sure you want to delete this library? ALL code blocks using this library will stop working.")))try{await c("interactive-code-block","library",t,null,{throwOnError:!0}),r("The library was deleted!",{type:"snackbar"})}catch(l){const p=(l?.message||"There was an error.")+" Please refresh the page and try again.";s(p,{type:"snackbar"})}},o=wp.components.FlexItem;return e.jsxs(wp.components.Flex,{className:"list-item",children:[e.jsx(o,{isBlock:!0,onDoubleClick:()=>i(!0),children:n.editedRecord.name}),e.jsx(wp.components.FlexItem,{children:e.jsx(wp.components.Button,{isDestructive:!0,onClick:a,children:wp.i18n.__("Delete")})})]})};m();window.addEventListener("load",function(){wp.element.render(e.jsxs(e.Fragment,{children:[e.jsx(f,{}),e.jsx(w,{})]}),document.querySelector("#libraries"))},!1);
