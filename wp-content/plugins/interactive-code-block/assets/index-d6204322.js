const st=1024;let Fe=0;class T{constructor(e,t){this.from=e,this.to=t}}class C{constructor(e={}){this.id=Fe++,this.perNode=!!e.perNode,this.deserialize=e.deserialize||(()=>{throw new Error("This node type doesn't define a deserialize function")})}add(e){if(this.perNode)throw new RangeError("Can't add per-node props to node types");return typeof e!="function"&&(e=D.match(e)),t=>{let r=e(t);return r===void 0?null:[this,r]}}}C.closedBy=new C({deserialize:l=>l.split(" ")});C.openedBy=new C({deserialize:l=>l.split(" ")});C.group=new C({deserialize:l=>l.split(" ")});C.contextHash=new C({perNode:!0});C.lookAhead=new C({perNode:!0});C.mounted=new C({perNode:!0});class De{constructor(e,t,r){this.tree=e,this.overlay=t,this.parser=r}}const He=Object.create(null);class D{constructor(e,t,r,i=0){this.name=e,this.props=t,this.id=r,this.flags=i}static define(e){let t=e.props&&e.props.length?Object.create(null):He,r=(e.top?1:0)|(e.skipped?2:0)|(e.error?4:0)|(e.name==null?8:0),i=new D(e.name||"",t,e.id,r);if(e.props){for(let n of e.props)if(Array.isArray(n)||(n=n(i)),n){if(n[0].perNode)throw new RangeError("Can't store a per-node prop on a node type");t[n[0].id]=n[1]}}return i}prop(e){return this.props[e.id]}get isTop(){return(this.flags&1)>0}get isSkipped(){return(this.flags&2)>0}get isError(){return(this.flags&4)>0}get isAnonymous(){return(this.flags&8)>0}is(e){if(typeof e=="string"){if(this.name==e)return!0;let t=this.prop(C.group);return t?t.indexOf(e)>-1:!1}return this.id==e}static match(e){let t=Object.create(null);for(let r in e)for(let i of r.split(" "))t[i]=e[r];return r=>{for(let i=r.prop(C.group),n=-1;n<(i?i.length:0);n++){let s=t[n<0?r.name:i[n]];if(s)return s}}}}D.none=new D("",Object.create(null),0,8);class ze{constructor(e){this.types=e;for(let t=0;t<e.length;t++)if(e[t].id!=t)throw new RangeError("Node type ids should correspond to array positions when creating a node set")}extend(...e){let t=[];for(let r of this.types){let i=null;for(let n of e){let s=n(r);s&&(i||(i=Object.assign({},r.props)),i[s[0].id]=s[1])}t.push(i?new D(r.name,i,r.id,r.flags):r)}return new ze(t)}}const le=new WeakMap,Ce=new WeakMap;var N;(function(l){l[l.ExcludeBuffers=1]="ExcludeBuffers",l[l.IncludeAnonymous=2]="IncludeAnonymous",l[l.IgnoreMounts=4]="IgnoreMounts",l[l.IgnoreOverlays=8]="IgnoreOverlays"})(N||(N={}));class O{constructor(e,t,r,i,n){if(this.type=e,this.children=t,this.positions=r,this.length=i,this.props=null,n&&n.length){this.props=Object.create(null);for(let[s,o]of n)this.props[typeof s=="number"?s:s.id]=o}}toString(){let e=this.prop(C.mounted);if(e&&!e.overlay)return e.tree.toString();let t="";for(let r of this.children){let i=r.toString();i&&(t&&(t+=","),t+=i)}return this.type.name?(/\W/.test(this.type.name)&&!this.type.isError?JSON.stringify(this.type.name):this.type.name)+(t.length?"("+t+")":""):t}cursor(e=0){return new ie(this.topNode,e)}cursorAt(e,t=0,r=0){let i=le.get(this)||this.topNode,n=new ie(i);return n.moveTo(e,t),le.set(this,n._tree),n}get topNode(){return new E(this,0,0,null)}resolve(e,t=0){let r=te(le.get(this)||this.topNode,e,t,!1);return le.set(this,r),r}resolveInner(e,t=0){let r=te(Ce.get(this)||this.topNode,e,t,!0);return Ce.set(this,r),r}iterate(e){let{enter:t,leave:r,from:i=0,to:n=this.length}=e;for(let s=this.cursor((e.mode||0)|N.IncludeAnonymous);;){let o=!1;if(s.from<=n&&s.to>=i&&(s.type.isAnonymous||t(s)!==!1)){if(s.firstChild())continue;o=!0}for(;o&&r&&!s.type.isAnonymous&&r(s),!s.nextSibling();){if(!s.parent())return;o=!0}}}prop(e){return e.perNode?this.props?this.props[e.id]:void 0:this.type.prop(e)}get propValues(){let e=[];if(this.props)for(let t in this.props)e.push([+t,this.props[t]]);return e}balance(e={}){return this.children.length<=8?this:we(D.none,this.children,this.positions,0,this.children.length,0,this.length,(t,r,i)=>new O(this.type,t,r,i,this.propValues),e.makeTree||((t,r,i)=>new O(D.none,t,r,i)))}static build(e){return We(e)}}O.empty=new O(D.none,[],[],0);class ye{constructor(e,t){this.buffer=e,this.index=t}get id(){return this.buffer[this.index-4]}get start(){return this.buffer[this.index-3]}get end(){return this.buffer[this.index-2]}get size(){return this.buffer[this.index-1]}get pos(){return this.index}next(){this.index-=4}fork(){return new ye(this.buffer,this.index)}}class Y{constructor(e,t,r){this.buffer=e,this.length=t,this.set=r}get type(){return D.none}toString(){let e=[];for(let t=0;t<this.buffer.length;)e.push(this.childString(t)),t=this.buffer[t+3];return e.join(",")}childString(e){let t=this.buffer[e],r=this.buffer[e+3],i=this.set.types[t],n=i.name;if(/\W/.test(n)&&!i.isError&&(n=JSON.stringify(n)),e+=4,r==e)return n;let s=[];for(;e<r;)s.push(this.childString(e)),e=this.buffer[e+3];return n+"("+s.join(",")+")"}findChild(e,t,r,i,n){let{buffer:s}=this,o=-1;for(let f=e;f!=t&&!(Oe(n,i,s[f+1],s[f+2])&&(o=f,r>0));f=s[f+3]);return o}slice(e,t,r){let i=this.buffer,n=new Uint16Array(t-e),s=0;for(let o=e,f=0;o<t;){n[f++]=i[o++],n[f++]=i[o++]-r;let a=n[f++]=i[o++]-r;n[f++]=i[o++]-e,s=Math.max(s,a)}return new Y(n,s,this.set)}}function Oe(l,e,t,r){switch(l){case-2:return t<e;case-1:return r>=e&&t<e;case 0:return t<e&&r>e;case 1:return t<=e&&r>e;case 2:return r>e;case 4:return!0}}function Te(l,e){let t=l.childBefore(e);for(;t;){let r=t.lastChild;if(!r||r.to!=t.to)break;r.type.isError&&r.from==r.to?(l=t,t=r.prevSibling):t=r}return l}function te(l,e,t,r){for(var i;l.from==l.to||(t<1?l.from>=e:l.from>e)||(t>-1?l.to<=e:l.to<e);){let s=!r&&l instanceof E&&l.index<0?null:l.parent;if(!s)return l;l=s}let n=r?0:N.IgnoreOverlays;if(r)for(let s=l,o=s.parent;o;s=o,o=s.parent)s instanceof E&&s.index<0&&((i=o.enter(e,t,n))===null||i===void 0?void 0:i.from)!=s.from&&(l=o);for(;;){let s=l.enter(e,t,n);if(!s)return l;l=s}}class E{constructor(e,t,r,i){this._tree=e,this.from=t,this.index=r,this._parent=i}get type(){return this._tree.type}get name(){return this._tree.type.name}get to(){return this.from+this._tree.length}nextChild(e,t,r,i,n=0){for(let s=this;;){for(let{children:o,positions:f}=s._tree,a=t>0?o.length:-1;e!=a;e+=t){let u=o[e],c=f[e]+s.from;if(Oe(i,r,c,c+u.length)){if(u instanceof Y){if(n&N.ExcludeBuffers)continue;let p=u.findChild(0,u.buffer.length,t,r-c,i);if(p>-1)return new U(new Le(s,u,e,c),null,p)}else if(n&N.IncludeAnonymous||!u.type.isAnonymous||xe(u)){let p;if(!(n&N.IgnoreMounts)&&u.props&&(p=u.prop(C.mounted))&&!p.overlay)return new E(p.tree,c,e,s);let b=new E(u,c,e,s);return n&N.IncludeAnonymous||!b.type.isAnonymous?b:b.nextChild(t<0?u.children.length-1:0,t,r,i)}}}if(n&N.IncludeAnonymous||!s.type.isAnonymous||(s.index>=0?e=s.index+t:e=t<0?-1:s._parent._tree.children.length,s=s._parent,!s))return null}}get firstChild(){return this.nextChild(0,1,0,4)}get lastChild(){return this.nextChild(this._tree.children.length-1,-1,0,4)}childAfter(e){return this.nextChild(0,1,e,2)}childBefore(e){return this.nextChild(this._tree.children.length-1,-1,e,-2)}enter(e,t,r=0){let i;if(!(r&N.IgnoreOverlays)&&(i=this._tree.prop(C.mounted))&&i.overlay){let n=e-this.from;for(let{from:s,to:o}of i.overlay)if((t>0?s<=n:s<n)&&(t<0?o>=n:o>n))return new E(i.tree,i.overlay[0].from+this.from,-1,this)}return this.nextChild(0,1,e,t,r)}nextSignificantParent(){let e=this;for(;e.type.isAnonymous&&e._parent;)e=e._parent;return e}get parent(){return this._parent?this._parent.nextSignificantParent():null}get nextSibling(){return this._parent&&this.index>=0?this._parent.nextChild(this.index+1,1,0,4):null}get prevSibling(){return this._parent&&this.index>=0?this._parent.nextChild(this.index-1,-1,0,4):null}cursor(e=0){return new ie(this,e)}get tree(){return this._tree}toTree(){return this._tree}resolve(e,t=0){return te(this,e,t,!1)}resolveInner(e,t=0){return te(this,e,t,!0)}enterUnfinishedNodesBefore(e){return Te(this,e)}getChild(e,t=null,r=null){let i=ue(this,e,t,r);return i.length?i[0]:null}getChildren(e,t=null,r=null){return ue(this,e,t,r)}toString(){return this._tree.toString()}get node(){return this}matchContext(e){return pe(this,e)}}function ue(l,e,t,r){let i=l.cursor(),n=[];if(!i.firstChild())return n;if(t!=null){for(;!i.type.is(t);)if(!i.nextSibling())return n}for(;;){if(r!=null&&i.type.is(r))return n;if(i.type.is(e)&&n.push(i.node),!i.nextSibling())return r==null?n:[]}}function pe(l,e,t=e.length-1){for(let r=l.parent;t>=0;r=r.parent){if(!r)return!1;if(!r.type.isAnonymous){if(e[t]&&e[t]!=r.name)return!1;t--}}return!0}class Le{constructor(e,t,r,i){this.parent=e,this.buffer=t,this.index=r,this.start=i}}class U{get name(){return this.type.name}get from(){return this.context.start+this.context.buffer.buffer[this.index+1]}get to(){return this.context.start+this.context.buffer.buffer[this.index+2]}constructor(e,t,r){this.context=e,this._parent=t,this.index=r,this.type=e.buffer.set.types[e.buffer.buffer[r]]}child(e,t,r){let{buffer:i}=this.context,n=i.findChild(this.index+4,i.buffer[this.index+3],e,t-this.context.start,r);return n<0?null:new U(this.context,this,n)}get firstChild(){return this.child(1,0,4)}get lastChild(){return this.child(-1,0,4)}childAfter(e){return this.child(1,e,2)}childBefore(e){return this.child(-1,e,-2)}enter(e,t,r=0){if(r&N.ExcludeBuffers)return null;let{buffer:i}=this.context,n=i.findChild(this.index+4,i.buffer[this.index+3],t>0?1:-1,e-this.context.start,t);return n<0?null:new U(this.context,this,n)}get parent(){return this._parent||this.context.parent.nextSignificantParent()}externalSibling(e){return this._parent?null:this.context.parent.nextChild(this.context.index+e,e,0,4)}get nextSibling(){let{buffer:e}=this.context,t=e.buffer[this.index+3];return t<(this._parent?e.buffer[this._parent.index+3]:e.buffer.length)?new U(this.context,this._parent,t):this.externalSibling(1)}get prevSibling(){let{buffer:e}=this.context,t=this._parent?this._parent.index+4:0;return this.index==t?this.externalSibling(-1):new U(this.context,this._parent,e.findChild(t,this.index,-1,0,4))}cursor(e=0){return new ie(this,e)}get tree(){return null}toTree(){let e=[],t=[],{buffer:r}=this.context,i=this.index+4,n=r.buffer[this.index+3];if(n>i){let s=r.buffer[this.index+1];e.push(r.slice(i,n,s)),t.push(0)}return new O(this.type,e,t,this.to-this.from)}resolve(e,t=0){return te(this,e,t,!1)}resolveInner(e,t=0){return te(this,e,t,!0)}enterUnfinishedNodesBefore(e){return Te(this,e)}toString(){return this.context.buffer.childString(this.index)}getChild(e,t=null,r=null){let i=ue(this,e,t,r);return i.length?i[0]:null}getChildren(e,t=null,r=null){return ue(this,e,t,r)}get node(){return this}matchContext(e){return pe(this,e)}}class ie{get name(){return this.type.name}constructor(e,t=0){if(this.mode=t,this.buffer=null,this.stack=[],this.index=0,this.bufferNode=null,e instanceof E)this.yieldNode(e);else{this._tree=e.context.parent,this.buffer=e.context;for(let r=e._parent;r;r=r._parent)this.stack.unshift(r.index);this.bufferNode=e,this.yieldBuf(e.index)}}yieldNode(e){return e?(this._tree=e,this.type=e.type,this.from=e.from,this.to=e.to,!0):!1}yieldBuf(e,t){this.index=e;let{start:r,buffer:i}=this.buffer;return this.type=t||i.set.types[i.buffer[e]],this.from=r+i.buffer[e+1],this.to=r+i.buffer[e+2],!0}yield(e){return e?e instanceof E?(this.buffer=null,this.yieldNode(e)):(this.buffer=e.context,this.yieldBuf(e.index,e.type)):!1}toString(){return this.buffer?this.buffer.buffer.childString(this.index):this._tree.toString()}enterChild(e,t,r){if(!this.buffer)return this.yield(this._tree.nextChild(e<0?this._tree._tree.children.length-1:0,e,t,r,this.mode));let{buffer:i}=this.buffer,n=i.findChild(this.index+4,i.buffer[this.index+3],e,t-this.buffer.start,r);return n<0?!1:(this.stack.push(this.index),this.yieldBuf(n))}firstChild(){return this.enterChild(1,0,4)}lastChild(){return this.enterChild(-1,0,4)}childAfter(e){return this.enterChild(1,e,2)}childBefore(e){return this.enterChild(-1,e,-2)}enter(e,t,r=this.mode){return this.buffer?r&N.ExcludeBuffers?!1:this.enterChild(1,e,t):this.yield(this._tree.enter(e,t,r))}parent(){if(!this.buffer)return this.yieldNode(this.mode&N.IncludeAnonymous?this._tree._parent:this._tree.parent);if(this.stack.length)return this.yieldBuf(this.stack.pop());let e=this.mode&N.IncludeAnonymous?this.buffer.parent:this.buffer.parent.nextSignificantParent();return this.buffer=null,this.yieldNode(e)}sibling(e){if(!this.buffer)return this._tree._parent?this.yield(this._tree.index<0?null:this._tree._parent.nextChild(this._tree.index+e,e,0,4,this.mode)):!1;let{buffer:t}=this.buffer,r=this.stack.length-1;if(e<0){let i=r<0?0:this.stack[r]+4;if(this.index!=i)return this.yieldBuf(t.findChild(i,this.index,-1,0,4))}else{let i=t.buffer[this.index+3];if(i<(r<0?t.buffer.length:t.buffer[this.stack[r]+3]))return this.yieldBuf(i)}return r<0?this.yield(this.buffer.parent.nextChild(this.buffer.index+e,e,0,4,this.mode)):!1}nextSibling(){return this.sibling(1)}prevSibling(){return this.sibling(-1)}atLastNode(e){let t,r,{buffer:i}=this;if(i){if(e>0){if(this.index<i.buffer.buffer.length)return!1}else for(let n=0;n<this.index;n++)if(i.buffer.buffer[n+3]<this.index)return!1;({index:t,parent:r}=i)}else({index:t,_parent:r}=this._tree);for(;r;{index:t,_parent:r}=r)if(t>-1)for(let n=t+e,s=e<0?-1:r._tree.children.length;n!=s;n+=e){let o=r._tree.children[n];if(this.mode&N.IncludeAnonymous||o instanceof Y||!o.type.isAnonymous||xe(o))return!1}return!0}move(e,t){if(t&&this.enterChild(e,0,4))return!0;for(;;){if(this.sibling(e))return!0;if(this.atLastNode(e)||!this.parent())return!1}}next(e=!0){return this.move(1,e)}prev(e=!0){return this.move(-1,e)}moveTo(e,t=0){for(;(this.from==this.to||(t<1?this.from>=e:this.from>e)||(t>-1?this.to<=e:this.to<e))&&this.parent(););for(;this.enterChild(1,e,t););return this}get node(){if(!this.buffer)return this._tree;let e=this.bufferNode,t=null,r=0;if(e&&e.context==this.buffer)e:for(let i=this.index,n=this.stack.length;n>=0;){for(let s=e;s;s=s._parent)if(s.index==i){if(i==this.index)return s;t=s,r=n+1;break e}i=this.stack[--n]}for(let i=r;i<this.stack.length;i++)t=new U(this.buffer,t,this.stack[i]);return this.bufferNode=new U(this.buffer,t,this.index)}get tree(){return this.buffer?null:this._tree._tree}iterate(e,t){for(let r=0;;){let i=!1;if(this.type.isAnonymous||e(this)!==!1){if(this.firstChild()){r++;continue}this.type.isAnonymous||(i=!0)}for(;i&&t&&t(this),i=this.type.isAnonymous,!this.nextSibling();){if(!r)return;this.parent(),r--,i=!0}}}matchContext(e){if(!this.buffer)return pe(this.node,e);let{buffer:t}=this.buffer,{types:r}=t.set;for(let i=e.length-1,n=this.stack.length-1;i>=0;n--){if(n<0)return pe(this.node,e,i);let s=r[t.buffer[this.stack[n]]];if(!s.isAnonymous){if(e[i]&&e[i]!=s.name)return!1;i--}}return!0}}function xe(l){return l.children.some(e=>e instanceof Y||!e.type.isAnonymous||xe(e))}function We(l){var e;let{buffer:t,nodeSet:r,maxBufferLength:i=1024,reused:n=[],minRepeatType:s=r.types.length}=l,o=Array.isArray(t)?new ye(t,t.length):t,f=r.types,a=0,u=0;function c(k,v,d,x,B){let{id:w,start:y,end:A,size:z}=o,R=u;for(;z<0;)if(o.next(),z==-1){let J=n[w];d.push(J),x.push(y-k);return}else if(z==-3){a=w;return}else if(z==-4){u=w;return}else throw new RangeError(`Unrecognized record size: ${z}`);let Z=f[w],V,q,ke=y-k;if(A-y<=i&&(q=_(o.pos-v,B))){let J=new Uint16Array(q.size-q.skip),j=o.pos-q.size,K=J.length;for(;o.pos>j;)K=I(q.start,J,K);V=new Y(J,A-q.start,r),ke=q.start-k}else{let J=o.pos-z;o.next();let j=[],K=[],Q=w>=s?w:-1,ee=0,se=A;for(;o.pos>J;)Q>=0&&o.id==Q&&o.size>=0?(o.end<=se-i&&(b(j,K,y,ee,o.end,se,Q,R),ee=j.length,se=o.end),o.next()):c(y,J,j,K,Q);if(Q>=0&&ee>0&&ee<j.length&&b(j,K,y,ee,y,se,Q,R),j.reverse(),K.reverse(),Q>-1&&ee>0){let ve=p(Z);V=we(Z,j,K,0,j.length,0,A-y,ve,ve)}else V=m(Z,j,K,A-y,R-A)}d.push(V),x.push(ke)}function p(k){return(v,d,x)=>{let B=0,w=v.length-1,y,A;if(w>=0&&(y=v[w])instanceof O){if(!w&&y.type==k&&y.length==x)return y;(A=y.prop(C.lookAhead))&&(B=d[w]+y.length+A)}return m(k,v,d,x,B)}}function b(k,v,d,x,B,w,y,A){let z=[],R=[];for(;k.length>x;)z.push(k.pop()),R.push(v.pop()+d-B);k.push(m(r.types[y],z,R,w-B,A-w)),v.push(B-d)}function m(k,v,d,x,B=0,w){if(a){let y=[C.contextHash,a];w=w?[y].concat(w):[y]}if(B>25){let y=[C.lookAhead,B];w=w?[y].concat(w):[y]}return new O(k,v,d,x,w)}function _(k,v){let d=o.fork(),x=0,B=0,w=0,y=d.end-i,A={size:0,start:0,skip:0};e:for(let z=d.pos-k;d.pos>z;){let R=d.size;if(d.id==v&&R>=0){A.size=x,A.start=B,A.skip=w,w+=4,x+=4,d.next();continue}let Z=d.pos-R;if(R<0||Z<z||d.start<y)break;let V=d.id>=s?4:0,q=d.start;for(d.next();d.pos>Z;){if(d.size<0)if(d.size==-3)V+=4;else break e;else d.id>=s&&(V+=4);d.next()}B=q,x+=R,w+=V}return(v<0||x==k)&&(A.size=x,A.start=B,A.skip=w),A.size>4?A:void 0}function I(k,v,d){let{id:x,start:B,end:w,size:y}=o;if(o.next(),y>=0&&x<s){let A=d;if(y>4){let z=o.pos-(y-4);for(;o.pos>z;)d=I(k,v,d)}v[--d]=A,v[--d]=w-k,v[--d]=B-k,v[--d]=x}else y==-3?a=x:y==-4&&(u=x);return d}let P=[],M=[];for(;o.pos>0;)c(l.start||0,l.bufferStart||0,P,M,-1);let S=(e=l.length)!==null&&e!==void 0?e:P.length?M[0]+P[0].length:0;return new O(f[l.topID],P.reverse(),M.reverse(),S)}const Ae=new WeakMap;function ae(l,e){if(!l.isAnonymous||e instanceof Y||e.type!=l)return 1;let t=Ae.get(e);if(t==null){t=1;for(let r of e.children){if(r.type!=l||!(r instanceof O)){t=1;break}t+=ae(l,r)}Ae.set(e,t)}return t}function we(l,e,t,r,i,n,s,o,f){let a=0;for(let m=r;m<i;m++)a+=ae(l,e[m]);let u=Math.ceil(a*1.5/8),c=[],p=[];function b(m,_,I,P,M){for(let S=I;S<P;){let k=S,v=_[S],d=ae(l,m[S]);for(S++;S<P;S++){let x=ae(l,m[S]);if(d+x>=u)break;d+=x}if(S==k+1){if(d>u){let x=m[k];b(x.children,x.positions,0,x.children.length,_[k]+M);continue}c.push(m[k])}else{let x=_[S-1]+m[S-1].length-v;c.push(we(l,m,_,k,S,v,x,null,f))}p.push(v+M-n)}}return b(e,t,r,i,0),(o||f)(c,p,s)}class lt{constructor(){this.map=new WeakMap}setBuffer(e,t,r){let i=this.map.get(e);i||this.map.set(e,i=new Map),i.set(t,r)}getBuffer(e,t){let r=this.map.get(e);return r&&r.get(t)}set(e,t){e instanceof U?this.setBuffer(e.context.buffer,e.index,t):e instanceof E&&this.map.set(e.tree,t)}get(e){return e instanceof U?this.getBuffer(e.context.buffer,e.index):e instanceof E?this.map.get(e.tree):void 0}cursorSet(e,t){e.buffer?this.setBuffer(e.buffer.buffer,e.index,t):this.map.set(e.tree,t)}cursorGet(e){return e.buffer?this.getBuffer(e.buffer.buffer,e.index):this.map.get(e.tree)}}class ne{constructor(e,t,r,i,n=!1,s=!1){this.from=e,this.to=t,this.tree=r,this.offset=i,this.open=(n?1:0)|(s?2:0)}get openStart(){return(this.open&1)>0}get openEnd(){return(this.open&2)>0}static addTree(e,t=[],r=!1){let i=[new ne(0,e.length,e,0,!1,r)];for(let n of t)n.to>e.length&&i.push(n);return i}static applyChanges(e,t,r=128){if(!t.length)return e;let i=[],n=1,s=e.length?e[0]:null;for(let o=0,f=0,a=0;;o++){let u=o<t.length?t[o]:null,c=u?u.fromA:1e9;if(c-f>=r)for(;s&&s.from<c;){let p=s;if(f>=p.from||c<=p.to||a){let b=Math.max(p.from,f)-a,m=Math.min(p.to,c)-a;p=b>=m?null:new ne(b,m,p.tree,p.offset+a,o>0,!!u)}if(p&&i.push(p),s.to>c)break;s=n<e.length?e[n++]:null}if(!u)break;f=u.toA,a=u.toA-u.toB}return i}}class ot{startParse(e,t,r){return typeof e=="string"&&(e=new Ue(e)),r=r?r.length?r.map(i=>new T(i.from,i.to)):[new T(0,0)]:[new T(0,e.length)],this.createParse(e,t||[],r)}parse(e,t,r){let i=this.startParse(e,t,r);for(;;){let n=i.advance();if(n)return n}}}class Ue{constructor(e){this.string=e}get length(){return this.string.length}chunk(e){return this.string.slice(e)}get lineChunks(){return!1}read(e,t){return this.string.slice(e,t)}}function ht(l){return(e,t,r,i)=>new Ke(e,l,t,r,i)}class Ne{constructor(e,t,r,i,n){this.parser=e,this.parse=t,this.overlay=r,this.target=i,this.ranges=n}}class qe{constructor(e,t,r,i,n,s,o){this.parser=e,this.predicate=t,this.mounts=r,this.index=i,this.start=n,this.target=s,this.prev=o,this.depth=0,this.ranges=[]}}const me=new C({perNode:!0});class Ke{constructor(e,t,r,i,n){this.nest=t,this.input=r,this.fragments=i,this.ranges=n,this.inner=[],this.innerDone=0,this.baseTree=null,this.stoppedAt=null,this.baseParse=e}advance(){if(this.baseParse){let r=this.baseParse.advance();if(!r)return null;if(this.baseParse=null,this.baseTree=r,this.startInner(),this.stoppedAt!=null)for(let i of this.inner)i.parse.stopAt(this.stoppedAt)}if(this.innerDone==this.inner.length){let r=this.baseTree;return this.stoppedAt!=null&&(r=new O(r.type,r.children,r.positions,r.length,r.propValues.concat([[me,this.stoppedAt]]))),r}let e=this.inner[this.innerDone],t=e.parse.advance();if(t){this.innerDone++;let r=Object.assign(Object.create(null),e.target.props);r[C.mounted.id]=new De(t,e.overlay,e.parser),e.target.props=r}return null}get parsedPos(){if(this.baseParse)return 0;let e=this.input.length;for(let t=this.innerDone;t<this.inner.length;t++)this.inner[t].ranges[0].from<e&&(e=Math.min(e,this.inner[t].parse.parsedPos));return e}stopAt(e){if(this.stoppedAt=e,this.baseParse)this.baseParse.stopAt(e);else for(let t=this.innerDone;t<this.inner.length;t++)this.inner[t].parse.stopAt(e)}startInner(){let e=new Ge(this.fragments),t=null,r=null,i=new ie(new E(this.baseTree,this.ranges[0].from,0,null),N.IncludeAnonymous|N.IgnoreMounts);e:for(let n,s;this.stoppedAt==null||i.from<this.stoppedAt;){let o=!0,f;if(e.hasNode(i)){if(t){let a=t.mounts.find(u=>u.frag.from<=i.from&&u.frag.to>=i.to&&u.mount.overlay);if(a)for(let u of a.mount.overlay){let c=u.from+a.pos,p=u.to+a.pos;c>=i.from&&p<=i.to&&!t.ranges.some(b=>b.from<p&&b.to>c)&&t.ranges.push({from:c,to:p})}}o=!1}else if(r&&(s=Ve(r.ranges,i.from,i.to)))o=s!=2;else if(!i.type.isAnonymous&&i.from<i.to&&(n=this.nest(i,this.input))){i.tree||Je(i);let a=e.findMounts(i.from,n.parser);if(typeof n.overlay=="function")t=new qe(n.parser,n.overlay,a,this.inner.length,i.from,i.tree,t);else{let u=Pe(this.ranges,n.overlay||[new T(i.from,i.to)]);u.length&&this.inner.push(new Ne(n.parser,n.parser.startParse(this.input,Be(a,u),u),n.overlay?n.overlay.map(c=>new T(c.from-i.from,c.to-i.from)):null,i.tree,u)),n.overlay?u.length&&(r={ranges:u,depth:0,prev:r}):o=!1}}else t&&(f=t.predicate(i))&&(f===!0&&(f=new T(i.from,i.to)),f.from<f.to&&t.ranges.push(f));if(o&&i.firstChild())t&&t.depth++,r&&r.depth++;else for(;!i.nextSibling();){if(!i.parent())break e;if(t&&!--t.depth){let a=Pe(this.ranges,t.ranges);a.length&&this.inner.splice(t.index,0,new Ne(t.parser,t.parser.startParse(this.input,Be(t.mounts,a),a),t.ranges.map(u=>new T(u.from-t.start,u.to-t.start)),t.target,a)),t=t.prev}r&&!--r.depth&&(r=r.prev)}}}}function Ve(l,e,t){for(let r of l){if(r.from>=t)break;if(r.to>e)return r.from<=e&&r.to>=t?2:1}return 0}function Se(l,e,t,r,i,n){if(e<t){let s=l.buffer[e+1];r.push(l.slice(e,t,s)),i.push(s-n)}}function Je(l){let{node:e}=l,t=0;do l.parent(),t++;while(!l.tree);let r=0,i=l.tree,n=0;for(;n=i.positions[r]+l.from,!(n<=e.from&&n+i.children[r].length>=e.to);r++);let s=i.children[r],o=s.buffer;function f(a,u,c,p,b){let m=a;for(;o[m+2]+n<=e.from;)m=o[m+3];let _=[],I=[];Se(s,a,m,_,I,p);let P=o[m+1],M=o[m+2],S=P+n==e.from&&M+n==e.to&&o[m]==e.type.id;return _.push(S?e.toTree():f(m+4,o[m+3],s.set.types[o[m]],P,M-P)),I.push(P-p),Se(s,o[m+3],u,_,I,p),new O(c,_,I,b)}i.children[r]=f(0,o.length,D.none,0,s.length);for(let a=0;a<=t;a++)l.childAfter(e.from)}class _e{constructor(e,t){this.offset=t,this.done=!1,this.cursor=e.cursor(N.IncludeAnonymous|N.IgnoreMounts)}moveTo(e){let{cursor:t}=this,r=e-this.offset;for(;!this.done&&t.from<r;)t.to>=e&&t.enter(r,1,N.IgnoreOverlays|N.ExcludeBuffers)||t.next(!1)||(this.done=!0)}hasNode(e){if(this.moveTo(e.from),!this.done&&this.cursor.from+this.offset==e.from&&this.cursor.tree)for(let t=this.cursor.tree;;){if(t==e.tree)return!0;if(t.children.length&&t.positions[0]==0&&t.children[0]instanceof O)t=t.children[0];else break}return!1}}class Ge{constructor(e){var t;if(this.fragments=e,this.curTo=0,this.fragI=0,e.length){let r=this.curFrag=e[0];this.curTo=(t=r.tree.prop(me))!==null&&t!==void 0?t:r.to,this.inner=new _e(r.tree,-r.offset)}else this.curFrag=this.inner=null}hasNode(e){for(;this.curFrag&&e.from>=this.curTo;)this.nextFrag();return this.curFrag&&this.curFrag.from<=e.from&&this.curTo>=e.to&&this.inner.hasNode(e)}nextFrag(){var e;if(this.fragI++,this.fragI==this.fragments.length)this.curFrag=this.inner=null;else{let t=this.curFrag=this.fragments[this.fragI];this.curTo=(e=t.tree.prop(me))!==null&&e!==void 0?e:t.to,this.inner=new _e(t.tree,-t.offset)}}findMounts(e,t){var r;let i=[];if(this.inner){this.inner.cursor.moveTo(e,1);for(let n=this.inner.cursor.node;n;n=n.parent){let s=(r=n.tree)===null||r===void 0?void 0:r.prop(C.mounted);if(s&&s.parser==t)for(let o=this.fragI;o<this.fragments.length;o++){let f=this.fragments[o];if(f.from>=n.to)break;f.tree==this.curFrag.tree&&i.push({frag:f,pos:n.from-f.offset,mount:s})}}}return i}}function Pe(l,e){let t=null,r=e;for(let i=1,n=0;i<l.length;i++){let s=l[i-1].to,o=l[i].from;for(;n<r.length;n++){let f=r[n];if(f.from>=o)break;f.to<=s||(t||(r=t=e.slice()),f.from<s?(t[n]=new T(f.from,s),f.to>o&&t.splice(n+1,0,new T(o,f.to))):f.to>o?t[n--]=new T(o,f.to):t.splice(n--,1))}}return r}function $e(l,e,t,r){let i=0,n=0,s=!1,o=!1,f=-1e9,a=[];for(;;){let u=i==l.length?1e9:s?l[i].to:l[i].from,c=n==e.length?1e9:o?e[n].to:e[n].from;if(s!=o){let p=Math.max(f,t),b=Math.min(u,c,r);p<b&&a.push(new T(p,b))}if(f=Math.min(u,c),f==1e9)break;u==f&&(s?(s=!1,i++):s=!0),c==f&&(o?(o=!1,n++):o=!0)}return a}function Be(l,e){let t=[];for(let{pos:r,mount:i,frag:n}of l){let s=r+(i.overlay?i.overlay[0].from:0),o=s+i.tree.length,f=Math.max(n.from,s),a=Math.min(n.to,o);if(i.overlay){let u=i.overlay.map(p=>new T(p.from+r,p.to+r)),c=$e(e,u,f,a);for(let p=0,b=f;;p++){let m=p==c.length,_=m?a:c[p].from;if(_>b&&t.push(new ne(b,_,i.tree,-s,n.from>=b||n.openStart,n.to<=_||n.openEnd)),m)break;b=c[p].to}}else t.push(new ne(f,a,i.tree,-s,n.from>=s||n.openStart,n.to<=o||n.openEnd))}return t}let Qe=0;class F{constructor(e,t,r){this.set=e,this.base=t,this.modified=r,this.id=Qe++}static define(e){if(e?.base)throw new Error("Can not derive from a modified tag");let t=new F([],null,[]);if(t.set.push(t),e)for(let r of e.set)t.set.push(r);return t}static defineModifier(){let e=new ce;return t=>t.modified.indexOf(e)>-1?t:ce.get(t.base||t,t.modified.concat(e).sort((r,i)=>r.id-i.id))}}let Xe=0;class ce{constructor(){this.instances=[],this.id=Xe++}static get(e,t){if(!t.length)return e;let r=t[0].instances.find(o=>o.base==e&&Ye(t,o.modified));if(r)return r;let i=[],n=new F(i,e,t);for(let o of t)o.instances.push(n);let s=Ze(t);for(let o of e.set)if(!o.modified.length)for(let f of s)i.push(ce.get(o,f));return n}}function Ye(l,e){return l.length==e.length&&l.every((t,r)=>t==e[r])}function Ze(l){let e=[[]];for(let t=0;t<l.length;t++)for(let r=0,i=e.length;r<i;r++)e.push(e[r].concat(l[t]));return e.sort((t,r)=>r.length-t.length)}function et(l){let e=Object.create(null);for(let t in l){let r=l[t];Array.isArray(r)||(r=[r]);for(let i of t.split(" "))if(i){let n=[],s=2,o=i;for(let c=0;;){if(o=="..."&&c>0&&c+3==i.length){s=1;break}let p=/^"(?:[^"\\]|\\.)*?"|[^\/!]+/.exec(o);if(!p)throw new RangeError("Invalid path: "+i);if(n.push(p[0]=="*"?"":p[0][0]=='"'?JSON.parse(p[0]):p[0]),c+=p[0].length,c==i.length)break;let b=i[c++];if(c==i.length&&b=="!"){s=0;break}if(b!="/")throw new RangeError("Invalid path: "+i);o=i.slice(c)}let f=n.length-1,a=n[f];if(!a)throw new RangeError("Invalid path: "+i);let u=new de(r,s,f>0?n.slice(0,f):null);e[a]=u.sort(e[a])}}return Ee.add(e)}const Ee=new C;class de{constructor(e,t,r,i){this.tags=e,this.mode=t,this.context=r,this.next=i}get opaque(){return this.mode==0}get inherit(){return this.mode==1}sort(e){return!e||e.depth<this.depth?(this.next=e,this):(e.next=this.sort(e.next),e)}get depth(){return this.context?this.context.length:0}}de.empty=new de([],2,null);function Re(l,e){let t=Object.create(null);for(let n of l)if(!Array.isArray(n.tag))t[n.tag.id]=n.class;else for(let s of n.tag)t[s.id]=n.class;let{scope:r,all:i=null}=e||{};return{style:n=>{let s=i;for(let o of n)for(let f of o.set){let a=t[f.id];if(a){s=s?s+" "+a:a;break}}return s},scope:r}}function tt(l,e){let t=null;for(let r of l){let i=r.style(e);i&&(t=t?t+" "+i:i)}return t}function rt(l,e,t,r=0,i=l.length){let n=new it(r,Array.isArray(e)?e:[e],t);n.highlightRange(l.cursor(),r,i,"",n.highlighters),n.flush(i)}class it{constructor(e,t,r){this.at=e,this.highlighters=t,this.span=r,this.class=""}startSpan(e,t){t!=this.class&&(this.flush(e),e>this.at&&(this.at=e),this.class=t)}flush(e){e>this.at&&this.class&&this.span(this.at,e,this.class)}highlightRange(e,t,r,i,n){let{type:s,from:o,to:f}=e;if(o>=r||f<=t)return;s.isTop&&(n=this.highlighters.filter(b=>!b.scope||b.scope(s)));let a=i,u=je(e)||de.empty,c=tt(n,u.tags);if(c&&(a&&(a+=" "),a+=c,u.mode==1&&(i+=(i?" ":"")+c)),this.startSpan(e.from,a),u.opaque)return;let p=e.tree&&e.tree.prop(C.mounted);if(p&&p.overlay){let b=e.node.enter(p.overlay[0].from+o,1),m=this.highlighters.filter(I=>!I.scope||I.scope(p.tree.type)),_=e.firstChild();for(let I=0,P=o;;I++){let M=I<p.overlay.length?p.overlay[I]:null,S=M?M.from+o:f,k=Math.max(t,P),v=Math.min(r,S);if(k<v&&_)for(;e.from<v&&(this.highlightRange(e,k,v,i,n),this.startSpan(Math.min(v,e.to),a),!(e.to>=S||!e.nextSibling())););if(!M||S>r)break;P=M.to+o,P>t&&(this.highlightRange(b.cursor(),Math.max(t,M.from+o),Math.min(r,P),i,m),this.startSpan(P,a))}_&&e.parent()}else if(e.firstChild()){do if(!(e.to<=t)){if(e.from>=r)break;this.highlightRange(e,t,r,i,n),this.startSpan(Math.min(r,e.to),a)}while(e.nextSibling());e.parent()}}}function je(l){let e=l.type.prop(Ee);for(;e&&e.context&&!l.matchContext(e.context);)e=e.next;return e||null}const h=F.define,oe=h(),G=h(),Ie=h(G),Me=h(G),$=h(),he=h($),ge=h($),W=h(),X=h(W),H=h(),L=h(),be=h(),re=h(be),fe=h(),g={comment:oe,lineComment:h(oe),blockComment:h(oe),docComment:h(oe),name:G,variableName:h(G),typeName:Ie,tagName:h(Ie),propertyName:Me,attributeName:h(Me),className:h(G),labelName:h(G),namespace:h(G),macroName:h(G),literal:$,string:he,docString:h(he),character:h(he),attributeValue:h(he),number:ge,integer:h(ge),float:h(ge),bool:h($),regexp:h($),escape:h($),color:h($),url:h($),keyword:H,self:h(H),null:h(H),atom:h(H),unit:h(H),modifier:h(H),operatorKeyword:h(H),controlKeyword:h(H),definitionKeyword:h(H),moduleKeyword:h(H),operator:L,derefOperator:h(L),arithmeticOperator:h(L),logicOperator:h(L),bitwiseOperator:h(L),compareOperator:h(L),updateOperator:h(L),definitionOperator:h(L),typeOperator:h(L),controlOperator:h(L),punctuation:be,separator:h(be),bracket:re,angleBracket:h(re),squareBracket:h(re),paren:h(re),brace:h(re),content:W,heading:X,heading1:h(X),heading2:h(X),heading3:h(X),heading4:h(X),heading5:h(X),heading6:h(X),contentSeparator:h(W),list:h(W),quote:h(W),emphasis:h(W),strong:h(W),link:h(W),monospace:h(W),strikethrough:h(W),inserted:h(),deleted:h(),changed:h(),invalid:h(),meta:fe,documentMeta:h(fe),annotation:h(fe),processingInstruction:h(fe),definition:F.defineModifier(),constant:F.defineModifier(),function:F.defineModifier(),standard:F.defineModifier(),local:F.defineModifier(),special:F.defineModifier()},nt=Re([{tag:g.link,class:"tok-link"},{tag:g.heading,class:"tok-heading"},{tag:g.emphasis,class:"tok-emphasis"},{tag:g.strong,class:"tok-strong"},{tag:g.keyword,class:"tok-keyword"},{tag:g.atom,class:"tok-atom"},{tag:g.bool,class:"tok-bool"},{tag:g.url,class:"tok-url"},{tag:g.labelName,class:"tok-labelName"},{tag:g.inserted,class:"tok-inserted"},{tag:g.deleted,class:"tok-deleted"},{tag:g.literal,class:"tok-literal"},{tag:g.string,class:"tok-string"},{tag:g.number,class:"tok-number"},{tag:[g.regexp,g.escape,g.special(g.string)],class:"tok-string2"},{tag:g.variableName,class:"tok-variableName"},{tag:g.local(g.variableName),class:"tok-variableName tok-local"},{tag:g.definition(g.variableName),class:"tok-variableName tok-definition"},{tag:g.special(g.variableName),class:"tok-variableName2"},{tag:g.definition(g.propertyName),class:"tok-propertyName tok-definition"},{tag:g.typeName,class:"tok-typeName"},{tag:g.namespace,class:"tok-namespace"},{tag:g.className,class:"tok-className"},{tag:g.macroName,class:"tok-macroName"},{tag:g.propertyName,class:"tok-propertyName"},{tag:g.operator,class:"tok-operator"},{tag:g.comment,class:"tok-comment"},{tag:g.meta,class:"tok-meta"},{tag:g.invalid,class:"tok-invalid"},{tag:g.punctuation,class:"tok-punctuation"}]),ft=Object.freeze(Object.defineProperty({__proto__:null,Tag:F,classHighlighter:nt,getStyleTags:je,highlightTree:rt,styleTags:et,tagHighlighter:Re,tags:g},Symbol.toStringTag,{value:"Module"}));export{st as D,N as I,C as N,ot as P,O as T,ne as a,Re as b,D as c,ze as d,lt as e,rt as h,ft as i,ht as p,et as s,g as t};
