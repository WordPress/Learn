import{s as C,E as w,O as F,P as x,a as d,Q as v,d as X,e as b,R as N,n as U,U as A,V as Y,S as M,W as $,X as q,A as Q,f as Z,Y as I,F as G,Z as J}from"./index-8f2db1d0.js";function R(t){let e=Object.keys(t).join(""),n=/\w/.test(e);return n&&(e=e.replace(/\w/g,"")),`[${n?"\\w":""}${e.replace(/[^\w\s]/g,"\\$&")}]`}function _(t){let e=Object.create(null),n=Object.create(null);for(let{label:l}of t){e[l[0]]=!0;for(let r=1;r<l.length;r++)n[l[r]]=!0}let i=R(e)+R(n)+"*$";return[new RegExp("^"+i),new RegExp(i)]}function Pe(t){let e=t.map(l=>typeof l=="string"?{label:l}:l),[n,i]=e.every(l=>/^\w+$/.test(l.label))?[/\w*$/,/\w+$/]:_(e);return l=>{let r=l.matchBefore(i);return r||l.explicit?{from:r?r.from:l.pos,options:e,validFor:n}:null}}function ve(t,e){return n=>{for(let i=C(n.state).resolveInner(n.pos,-1);i;i=i.parent){if(t.indexOf(i.name)>-1)return null;if(i.type.isTop)break}return e(n)}}const ee=Q.define(),te=w.baseTheme({".cm-tooltip.cm-tooltip-autocomplete":{"& > ul":{fontFamily:"monospace",whiteSpace:"nowrap",overflow:"hidden auto",maxWidth_fallback:"700px",maxWidth:"min(700px, 95vw)",minWidth:"250px",maxHeight:"10em",height:"100%",listStyle:"none",margin:0,padding:0,"& > li":{overflowX:"hidden",textOverflow:"ellipsis",cursor:"pointer",padding:"1px 3px",lineHeight:1.2}}},"&light .cm-tooltip-autocomplete ul li[aria-selected]":{background:"#17c",color:"white"},"&light .cm-tooltip-autocomplete-disabled ul li[aria-selected]":{background:"#777"},"&dark .cm-tooltip-autocomplete ul li[aria-selected]":{background:"#347",color:"white"},"&dark .cm-tooltip-autocomplete-disabled ul li[aria-selected]":{background:"#444"},".cm-completionListIncompleteTop:before, .cm-completionListIncompleteBottom:after":{content:'"¬∑¬∑¬∑"',opacity:.5,display:"block",textAlign:"center"},".cm-tooltip.cm-completionInfo":{position:"absolute",padding:"3px 9px",width:"max-content",maxWidth:"400px",boxSizing:"border-box"},".cm-completionInfo.cm-completionInfo-left":{right:"100%"},".cm-completionInfo.cm-completionInfo-right":{left:"100%"},".cm-completionInfo.cm-completionInfo-left-narrow":{right:"30px"},".cm-completionInfo.cm-completionInfo-right-narrow":{left:"30px"},"&light .cm-snippetField":{backgroundColor:"#00000022"},"&dark .cm-snippetField":{backgroundColor:"#ffffff22"},".cm-snippetFieldPosition":{verticalAlign:"text-top",width:0,height:"1.15em",display:"inline-block",margin:"0 -0.7px -.7em",borderLeft:"1.4px dotted #888"},".cm-completionMatchedText":{textDecoration:"underline"},".cm-completionDetail":{marginLeft:"0.5em",fontStyle:"italic"},".cm-completionIcon":{fontSize:"90%",width:".8em",display:"inline-block",textAlign:"center",paddingRight:".6em",opacity:"0.6",boxSizing:"content-box"},".cm-completionIcon-function, .cm-completionIcon-method":{"&:after":{content:"'∆í'"}},".cm-completionIcon-class":{"&:after":{content:"'‚óã'"}},".cm-completionIcon-interface":{"&:after":{content:"'‚óå'"}},".cm-completionIcon-variable":{"&:after":{content:"'ùë•'"}},".cm-completionIcon-constant":{"&:after":{content:"'ùê∂'"}},".cm-completionIcon-type":{"&:after":{content:"'ùë°'"}},".cm-completionIcon-enum":{"&:after":{content:"'‚à™'"}},".cm-completionIcon-property":{"&:after":{content:"'‚ñ°'"}},".cm-completionIcon-keyword":{"&:after":{content:"'üîëÔ∏é'"}},".cm-completionIcon-namespace":{"&:after":{content:"'‚ñ¢'"}},".cm-completionIcon-text":{"&:after":{content:"'abc'",fontSize:"50%",verticalAlign:"middle"}}});class ne{constructor(e,n,i,l){this.field=e,this.line=n,this.from=i,this.to=l}}class E{constructor(e,n,i){this.field=e,this.from=n,this.to=i}map(e){let n=e.mapPos(this.from,-1,A.TrackDel),i=e.mapPos(this.to,1,A.TrackDel);return n==null||i==null?null:new E(this.field,n,i)}}class O{constructor(e,n){this.lines=e,this.fieldPositions=n}instantiate(e,n){let i=[],l=[n],r=e.doc.lineAt(n),c=/^\s*/.exec(r.text)[0];for(let o of this.lines){if(i.length){let f=c,a=/^\t*/.exec(o)[0].length;for(let m=0;m<a;m++)f+=e.facet(Z);l.push(n+f.length-a),o=f+o.slice(a)}i.push(o),n+=o.length+1}let s=this.fieldPositions.map(o=>new E(o.field,l[o.line]+o.from,l[o.line]+o.to));return{text:i,ranges:s}}static parse(e){let n=[],i=[],l=[],r;for(let c of e.split(/\r\n?|\n/)){for(;r=/[#$]\{(?:(\d+)(?::([^}]*))?|([^}]*))\}/.exec(c);){let s=r[1]?+r[1]:null,o=r[2]||r[3]||"",f=-1;for(let a=0;a<n.length;a++)(s!=null?n[a].seq==s:o&&n[a].name==o)&&(f=a);if(f<0){let a=0;for(;a<n.length&&(s==null||n[a].seq!=null&&n[a].seq<s);)a++;n.splice(a,0,{seq:s,name:o}),f=a;for(let m of l)m.field>=f&&m.field++}l.push(new ne(f,i.length,r.index,r.index+o.length)),c=c.slice(0,r.index)+o+c.slice(r.index+r[0].length)}for(let s;s=/\\([{}])/.exec(c);){c=c.slice(0,s.index)+s[1]+c.slice(s.index+s[0].length);for(let o of l)o.line==i.length&&o.from>s.index&&(o.from--,o.to--)}i.push(c)}return new O(i,l)}}let ie=I.widget({widget:new class extends J{toDOM(){let t=document.createElement("span");return t.className="cm-snippetFieldPosition",t}ignoreEvent(){return!1}}}),le=I.mark({class:"cm-snippetField"});class u{constructor(e,n){this.ranges=e,this.active=n,this.deco=I.set(e.map(i=>(i.from==i.to?ie:le).range(i.from,i.to)))}map(e){let n=[];for(let i of this.ranges){let l=i.map(e);if(!l)return null;n.push(l)}return new u(n,this.active)}selectionInsideField(e){return e.ranges.every(n=>this.ranges.some(i=>i.field==this.active&&i.from<=n.from&&i.to>=n.to))}}const y=b.define({map(t,e){return t&&t.map(e)}}),oe=b.define(),h=M.define({create(){return null},update(t,e){for(let n of e.effects){if(n.is(y))return n.value;if(n.is(oe)&&t)return new u(t.ranges,n.value)}return t&&e.docChanged&&(t=t.map(e.changes)),t&&e.selection&&!t.selectionInsideField(e.selection)&&(t=null),t},provide:t=>w.decorations.from(t,e=>e?e.deco:I.none)});function k(t,e){return d.create(t.filter(n=>n.field==e).map(n=>d.range(n.from,n.to)))}function re(t){let e=O.parse(t);return(n,i,l,r)=>{let{text:c,ranges:s}=e.instantiate(n.state,l),o={changes:{from:l,to:r,insert:X.of(c)},scrollIntoView:!0,annotations:ee.of(i)};if(s.length&&(o.selection=k(s,0)),s.length>1){let f=new u(s,0),a=o.effects=[y.of(f)];n.state.field(h,!1)===void 0&&a.push(b.appendConfig.of([h,de,me,te]))}n.dispatch(n.state.update(o))}}function V(t){return({state:e,dispatch:n})=>{let i=e.field(h,!1);if(!i||t<0&&i.active==0)return!1;let l=i.active+t,r=t>0&&!i.ranges.some(c=>c.field==l+t);return n(e.update({selection:k(i.ranges,l),effects:y.of(r?null:new u(i.ranges,l))})),!0}}const ce=({state:t,dispatch:e})=>t.field(h,!1)?(e(t.update({effects:y.of(null)})),!0):!1,se=V(1),ae=V(-1),fe=[{key:"Tab",run:se,shift:ae},{key:"Escape",run:ce}],T=G.define({combine(t){return t.length?t[0]:fe}}),de=N.highest(U.compute([T],t=>t.facet(T)));function Ae(t,e){return Object.assign(Object.assign({},e),{apply:re(t)})}const me=w.domEventHandlers({mousedown(t,e){let n=e.state.field(h,!1),i;if(!n||(i=e.posAtCoords({x:t.clientX,y:t.clientY}))==null)return!1;let l=n.ranges.find(r=>r.from<=i&&r.to>=i);return!l||l.field==n.active?!1:(e.dispatch({selection:k(n.ranges,l.field),effects:y.of(n.ranges.some(r=>r.field>l.field)?new u(n.ranges,l.field):null)}),!0)}}),g={brackets:["(","[","{","'",'"'],before:")]}:;>",stringPrefixes:[]},p=b.define({map(t,e){let n=e.mapPos(t,-1,A.TrackAfter);return n??void 0}}),B=b.define({map(t,e){return e.mapPos(t)}}),D=new class extends Y{};D.startSide=1;D.endSide=-1;const z=M.define({create(){return $.empty},update(t,e){if(e.selection){let n=e.state.doc.lineAt(e.selection.main.head).from,i=e.startState.doc.lineAt(e.startState.selection.main.head).from;n!=e.changes.mapPos(i,-1)&&(t=$.empty)}t=t.map(e.changes);for(let n of e.effects)n.is(p)?t=t.update({add:[D.range(n.value,n.value+1)]}):n.is(B)&&(t=t.update({filter:i=>i!=n.value}));return t}});function Ce(){return[ue,z]}const P="()[]{}<>";function H(t){for(let e=0;e<P.length;e+=2)if(P.charCodeAt(e)==t)return P.charAt(e+1);return q(t<128?t:t+1)}function L(t,e){return t.languageDataAt("closeBrackets",e)[0]||g}const pe=typeof navigator=="object"&&/Android\b/.test(navigator.userAgent),ue=w.inputHandler.of((t,e,n,i)=>{if((pe?t.composing:t.compositionStarted)||t.state.readOnly)return!1;let l=t.state.selection.main;if(i.length>2||i.length==2&&F(x(i,0))==1||e!=l.from||n!=l.to)return!1;let r=ge(t.state,i);return r?(t.dispatch(r),!0):!1}),he=({state:t,dispatch:e})=>{if(t.readOnly)return!1;let i=L(t,t.selection.main.head).brackets||g.brackets,l=null,r=t.changeByRange(c=>{if(c.empty){let s=xe(t.doc,c.head);for(let o of i)if(o==s&&S(t.doc,c.head)==H(x(o,0)))return{changes:{from:c.head-o.length,to:c.head+o.length},range:d.cursor(c.head-o.length)}}return{range:l=c}});return l||e(t.update(r,{scrollIntoView:!0,userEvent:"delete.backward"})),!l},Fe=[{key:"Backspace",run:he}];function ge(t,e){let n=L(t,t.selection.main.head),i=n.brackets||g.brackets;for(let l of i){let r=H(x(l,0));if(e==l)return r==l?we(t,l,i.indexOf(l+l+l)>-1,n):be(t,l,r,n.before||g.before);if(e==r&&K(t,t.selection.main.from))return ye(t,l,r)}return null}function K(t,e){let n=!1;return t.field(z).between(0,t.doc.length,i=>{i==e&&(n=!0)}),n}function S(t,e){let n=t.sliceString(e,e+2);return n.slice(0,F(x(n,0)))}function xe(t,e){let n=t.sliceString(e-2,e);return F(x(n,0))==n.length?n:n.slice(1)}function be(t,e,n,i){let l=null,r=t.changeByRange(c=>{if(!c.empty)return{changes:[{insert:e,from:c.from},{insert:n,from:c.to}],effects:p.of(c.to+e.length),range:d.range(c.anchor+e.length,c.head+e.length)};let s=S(t.doc,c.head);return!s||/\s/.test(s)||i.indexOf(s)>-1?{changes:{insert:e+n,from:c.head},effects:p.of(c.head+e.length),range:d.cursor(c.head+e.length)}:{range:l=c}});return l?null:t.update(r,{scrollIntoView:!0,userEvent:"input.type"})}function ye(t,e,n){let i=null,l=t.selection.ranges.map(r=>r.empty&&S(t.doc,r.head)==n?d.cursor(r.head+n.length):i=r);return i?null:t.update({selection:d.create(l,t.selection.mainIndex),scrollIntoView:!0,effects:t.selection.ranges.map(({from:r})=>B.of(r))})}function we(t,e,n,i){let l=i.stringPrefixes||g.stringPrefixes,r=null,c=t.changeByRange(s=>{if(!s.empty)return{changes:[{insert:e,from:s.from},{insert:e,from:s.to}],effects:p.of(s.to+e.length),range:d.range(s.anchor+e.length,s.head+e.length)};let o=s.head,f=S(t.doc,o),a;if(f==e){if(W(t,o))return{changes:{insert:e+e,from:o},effects:p.of(o+e.length),range:d.cursor(o+e.length)};if(K(t,o)){let m=n&&t.sliceDoc(o,o+e.length*3)==e+e+e;return{range:d.cursor(o+e.length*(m?3:1)),effects:B.of(o)}}}else{if(n&&t.sliceDoc(o-2*e.length,o)==e+e&&(a=j(t,o-2*e.length,l))>-1&&W(t,a))return{changes:{insert:e+e+e+e,from:o},effects:p.of(o+e.length),range:d.cursor(o+e.length)};if(t.charCategorizer(o)(f)!=v.Word&&j(t,o,l)>-1&&!Ie(t,o,e,l))return{changes:{insert:e+e,from:o},effects:p.of(o+e.length),range:d.cursor(o+e.length)}}return{range:r=s}});return r?null:t.update(c,{scrollIntoView:!0,userEvent:"input.type"})}function W(t,e){let n=C(t).resolveInner(e+1);return n.parent&&n.from==e}function Ie(t,e,n,i){let l=C(t).resolveInner(e,-1),r=i.reduce((c,s)=>Math.max(c,s.length),0);for(let c=0;c<5;c++){let s=t.sliceDoc(l.from,Math.min(l.to,l.from+n.length+r)),o=s.indexOf(n);if(!o||o>-1&&i.indexOf(s.slice(0,o))>-1){let a=l.firstChild;for(;a&&a.from==l.from&&a.to-a.from>n.length+o;){if(t.sliceDoc(a.to-n.length,a.to)==n)return!1;a=a.firstChild}return!0}let f=l.to==e&&l.parent;if(!f)break;l=f}return!1}function j(t,e,n){let i=t.charCategorizer(e);if(i(t.sliceDoc(e-1,e))!=v.Word)return e;for(let l of n){let r=e-l.length;if(t.sliceDoc(r,e)==l&&i(t.sliceDoc(r-1,r))!=v.Word)return r}return-1}export{Ce as a,Pe as b,Fe as c,ve as i,Ae as s};
