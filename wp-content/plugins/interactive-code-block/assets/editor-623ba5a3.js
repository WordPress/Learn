import{j as t}from"./jsx-runtime-93b56483.js";import{i as O}from"./entities-35c9150f.js";import{_ as T}from"./preload-helper-41c905a7.js";import{L}from"./index-5648a310.js";import{u as h,I as R,b as D}from"./base64-utils-b7446a6d.js";import{c as H,g as I,S as M}from"./index-f75e1766.js";import"./comlink.js";const B=wp.element.createElement(wp.primitives.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},wp.element.createElement(wp.primitives.Path,{d:"M14.5 13.8c-1.1 0-2.1.7-2.4 1.8H4V17h8.1c.3 1 1.3 1.8 2.4 1.8s2.1-.7 2.4-1.8H20v-1.5h-3.1c-.3-1-1.3-1.7-2.4-1.7zM11.9 7c-.3-1-1.3-1.8-2.4-1.8S7.4 6 7.1 7H4v1.5h3.1c.3 1 1.3 1.8 2.4 1.8s2.1-.7 2.4-1.8H20V7h-8.1z"})),$=B,G=({options:e,optionsLabel:s,icon:n,value:p,onChange:d,...r})=>{const i=e.find(a=>p===a.value);return t.jsx(wp.components.Dropdown,{renderToggle:({isOpen:a,onToggle:l})=>t.jsx(wp.components.Button,{onClick:l,icon:n,"aria-expanded":a,"aria-haspopup":"true",children:i?i.label:""}),renderContent:({onClose:a})=>t.jsx(wp.components.NavigableMenu,{role:"menu",children:t.jsx(wp.components.MenuGroup,{label:s,children:e.map(l=>{const u=l.value===i?.value;return t.jsx(wp.components.MenuItem,{role:"menuitemradio",isSelected:u,className:H("syntaxhighlighter-toolbar-dropdown__option",{"is-selected":u}),onClick:()=>{d(l.value),a()},children:l.label},l.value)})})}),...r})},c=e=>e.stopImmediatePropagation(),N=["a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","tab","[","]","{","}"],U=Object.fromEntries(N.flatMap(e=>[[e,c],[wp.keycodes.rawShortcut.access(e),c],[wp.keycodes.rawShortcut.ctrl(e),c],[wp.keycodes.rawShortcut.ctrlShift(e),c],[wp.keycodes.rawShortcut.primary(e),c],[wp.keycodes.rawShortcut.primaryShift(e),c],[wp.keycodes.rawShortcut.primaryAlt(e),c]]));function z({children:e,isSelected:s}){return wp.element.useEffect(()=>{if(s)return document.addEventListener("copy",c,{capture:!0}),document.addEventListener("cut",c,{capture:!0}),document.addEventListener("paste",c,{capture:!0}),()=>{document.removeEventListener("copy",c,{capture:!0}),document.removeEventListener("cut",c,{capture:!0}),document.removeEventListener("paste",c,{capture:!0})}},[s]),t.jsx(wp.components.KeyboardShortcuts,{shortcuts:U,children:e})}document.addEventListener("DOMContentLoaded",()=>{T(()=>import("./base64-utils-b7446a6d.js").then(e=>e.i),["./base64-utils-b7446a6d.js","./preload-helper-41c905a7.js","./jsx-runtime-93b56483.js","./index-f75e1766.js","./comlink.js","./index-aa2aa845.css","./base64-utils-5b49112b.css"],import.meta.url)});const w=[{label:"PHP",value:"php"},{label:"SQL",value:"sql"},{label:"JavaScript",value:"js"}];function V({attributes:e,isSelected:s,setAttributes:n}){const p=wp.coreData.useEntityRecords("interactive-code-block","script");function d(o){return I(o)||p.records?.find(m=>m.id===o)}const r=d(e.executionScript)||p?.[0],i=wp.element.useCallback(o=>{const m=d(o);m&&r?.runner!==m?.runner&&n({libraries:[]}),n({executionScript:o})},[r]),a=wp.coreData.useEntityRecords("interactive-code-block","library"),l=wp.element.useMemo(()=>a.records?.filter(o=>e.libraries.includes(o.id)||r?.libraries?.includes(o.id)),[e.libraries,a.hasResolved]),u=wp.element.useCallback(o=>{n({code:h(o)})},[]),P=wp.element.useCallback(o=>{n({cachedOutput:h(o)})},[]);return t.jsxs(t.Fragment,{children:[t.jsx(wp.blockEditor.BlockControls,{children:t.jsx(wp.components.ToolbarGroup,{children:t.jsx(G,{optionsLabel:"Display settings",icon:$,value:e.fileType,onChange:o=>n({fileType:o}),options:w.map(o=>({label:`Highlighting: ${o.label}`,value:o.value}))})})}),t.jsx(wp.blockEditor.InspectorControls,{children:t.jsxs(wp.components.PanelBody,{title:"PHP Snippet settings",children:[t.jsx(wp.components.PanelRow,{children:t.jsx(wp.components.ToggleControl,{label:"Show the output on the first load?",onChange:()=>n({showCachedOutput:!e.showCachedOutput}),checked:e.showCachedOutput})}),t.jsx(wp.components.PanelRow,{className:"interactive-code-block__panel-row",children:t.jsx(wp.components.SelectControl,{label:"Code highlighting",value:e.fileType,options:w,onChange:o=>n({fileType:o})})}),t.jsx(wp.components.PanelRow,{className:"interactive-code-block__panel-row",children:t.jsx(q,{selected:r?.id||"",onChange:i})}),t.jsx(wp.components.PanelRow,{className:"interactive-code-block__panel-row",children:t.jsx(L,{selected:e.libraries,librariesIncludedByScript:r?.libraries,onChange:o=>n({libraries:o})})})]})}),!l||!r?t.jsx(wp.components.Spinner,{}):t.jsx(z,{isSelected:s,children:t.jsx(R,{executionScript:r,libraries:l,fileType:e.fileType,initialCode:v(e.code),initialOutput:v(e.cachedOutput),onChange:u,onSave:u,onEval:P})})]})}function v(e){if(!e)return"";try{return D(e)}catch{return e}}function q({selected:e,onChange:s}){const n=wp.coreData.useEntityRecords("interactive-code-block","script");if(n.records===null)return t.jsx(wp.components.Spinner,{});const p=M.map(i=>({label:i.defaultExecutionScript.name,value:i.defaultExecutionScript.id})),d=n.records.map(i=>({label:i.name||"",value:i.id})),r=[...p,...d];return t.jsx(wp.components.SelectControl,{label:"Execution script",value:e,options:r,onChange:s})}const b="https://schemas.wp.org/trunk/block.json",S="wordpress-playground/interactive-code",x="Interactive Code",f="shield",y="common",g={code:{type:"string"},fileType:{type:"string",enum:["php","sql","js"],default:"php"},executionScript:{type:"string",default:"PHP"},libraries:{type:"array",default:[]},cachedOutput:{type:"string"},showCachedOutput:{type:"boolean",default:!0}},j="interactive-code-block",k="interactive-code-block-editor",E="interactive-code-block",C="interactive-code-block-editor",J={$schema:b,name:S,title:x,icon:f,category:y,attributes:g,viewScript:j,editorScript:k,style:E,editorStyle:C},_=Object.freeze(Object.defineProperty({__proto__:null,$schema:b,attributes:g,category:y,default:J,editorScript:k,editorStyle:C,icon:f,name:S,style:E,title:x,viewScript:j},Symbol.toStringTag,{value:"Module"})),K=""+new URL("block.json",import.meta.url).href,ee=Object.freeze(Object.defineProperty({__proto__:null,default:K},Symbol.toStringTag,{value:"Module"})),{name:te}=_;O();wp.blocks.registerBlockType(_,{icon:"shield",edit:V,save:({attributes:e})=>t.jsx("div",{...wp.blockEditor.useBlockProps.save(),children:e.code})});export{ee as blockJsonUrl,_ as metadata,te as name};
